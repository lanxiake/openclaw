# OpenClaw AI 个人助理平台 - 管理后台系统设计

> 版本: 1.0 | 创建日期: 2026-02-08 | 状态: 整合版
>
> 本文档整合用户端管理面板和服务端管理后台设计

---

## 修订记录

| 版本 | 日期 | 修订内容 |
|------|------|----------|
| 1.0 | 2026-02-08 | 整合 08-Web管理后台设计.md、09-服务端管理后台设计.md |

---

## 1. 概述

### 1.1 系统定位

OpenClaw 平台包含两个独立的管理后台：

| 对比项 | 用户端管理面板 (web-admin) | 服务端管理后台 (admin-console) |
|--------|---------------------------|-------------------------------|
| 目标用户 | 最终用户 | 平台运营团队 |
| 功能范围 | 管理自己的设备、技能、订阅 | 管理所有用户、订阅、技能商店 |
| 数据权限 | 仅能访问自己的数据 | 可访问全平台数据 |
| 认证方式 | 用户账号登录 | 管理员账号登录 |
| 部署路径 | `apps/web-admin` | `apps/admin-console` |

### 1.2 技术栈

| 技术 | 版本 | 说明 |
|------|------|------|
| React | 18+ | UI 框架 |
| TypeScript | 5.x | 类型安全 |
| Vite | 5.x | 构建工具 |
| React Router | 6.x | 路由 |
| TanStack Query | 5.x | 数据获取 |
| Zustand | 4.x | 状态管理 |
| shadcn/ui | latest | UI 组件库 |
| Tailwind CSS | 3.x | 样式 |
| Recharts | 2.x | 图表 |
| React Hook Form | 7.x | 表单 |
| Zod | 3.x | 验证 |

---

## 2. 用户端管理面板 (web-admin)

### 2.1 功能模块

| 模块 | 功能 | 优先级 |
|------|------|--------|
| 设备管理 | 查看/管理已配对设备、添加新设备 | P0 |
| 技能管理 | 已安装技能、技能商店、技能配置 | P0 |
| 订阅管理 | 当前订阅、升级/续费、账单历史 | P0 |
| 个人设置 | 账号信息、安全设置、偏好设置 | P1 |
| 使用统计 | 使用量统计、操作历史 | P2 |

### 2.2 页面结构

```
apps/web-admin/
├── src/
│   ├── pages/
│   │   ├── auth/
│   │   │   ├── LoginPage.tsx
│   │   │   └── RegisterPage.tsx
│   │   ├── dashboard/
│   │   │   └── DashboardPage.tsx
│   │   ├── devices/
│   │   │   ├── DeviceListPage.tsx
│   │   │   └── DevicePairPage.tsx
│   │   ├── skills/
│   │   │   ├── SkillListPage.tsx
│   │   │   ├── SkillStorePage.tsx
│   │   │   └── SkillDetailPage.tsx
│   │   ├── subscription/
│   │   │   ├── SubscriptionPage.tsx
│   │   │   └── BillingHistoryPage.tsx
│   │   └── settings/
│   │       ├── ProfilePage.tsx
│   │       ├── SecurityPage.tsx
│   │       └── PreferencesPage.tsx
│   ├── components/
│   ├── hooks/
│   ├── services/
│   └── stores/
```

### 2.3 路由配置

```typescript
const routes = [
  // 公开路由
  { path: '/login', element: <LoginPage /> },
  { path: '/register', element: <RegisterPage /> },

  // 受保护路由
  {
    path: '/',
    element: <ProtectedRoute><UserLayout /></ProtectedRoute>,
    children: [
      { index: true, element: <DashboardPage /> },
      { path: 'devices', element: <DeviceListPage /> },
      { path: 'devices/pair', element: <DevicePairPage /> },
      { path: 'skills', element: <SkillListPage /> },
      { path: 'skills/store', element: <SkillStorePage /> },
      { path: 'skills/:skillId', element: <SkillDetailPage /> },
      { path: 'subscription', element: <SubscriptionPage /> },
      { path: 'billing', element: <BillingHistoryPage /> },
      { path: 'settings', element: <ProfilePage /> },
      { path: 'settings/security', element: <SecurityPage /> },
      { path: 'settings/preferences', element: <PreferencesPage /> },
    ],
  },
];
```

### 2.4 API 设计

#### 设备管理 API

```
GET    /api/v1/devices              # 获取设备列表
POST   /api/v1/devices/pair         # 配对新设备
GET    /api/v1/devices/:id          # 获取设备详情
PATCH  /api/v1/devices/:id          # 更新设备信息
DELETE /api/v1/devices/:id          # 解绑设备
POST   /api/v1/devices/:id/revoke   # 撤销设备授权
```

#### 技能管理 API

```
GET    /api/v1/skills               # 获取已安装技能
GET    /api/v1/skills/store         # 技能商店列表
GET    /api/v1/skills/:id           # 技能详情
POST   /api/v1/skills/:id/install   # 安装技能
DELETE /api/v1/skills/:id           # 卸载技能
PATCH  /api/v1/skills/:id/config    # 更新技能配置
```

#### 订阅管理 API

```
GET    /api/v1/subscription         # 获取当前订阅
POST   /api/v1/subscription/upgrade # 升级订阅
POST   /api/v1/subscription/renew   # 续费订阅
POST   /api/v1/subscription/cancel  # 取消订阅
GET    /api/v1/billing/history      # 账单历史
GET    /api/v1/billing/invoices/:id # 下载发票
```

---

## 3. 服务端管理后台 (admin-console)

### 3.1 角色权限

| 角色 | 权限范围 | 典型操作 |
|------|----------|----------|
| 超级管理员 | 全部权限 | 系统配置、权限管理、所有运营操作 |
| 运营主管 | 用户管理 + 订阅管理 + 技能管理 | 处理用户投诉、调整订阅、上下架技能 |
| 运营专员 | 只读权限 + 有限写权限 | 查看数据、处理简单工单 |
| 技术支持 | 日志查看 + 设备管理 | 排查问题、查看日志 |

### 3.2 功能模块

#### 第一期 (P0)

| 模块 | 功能 |
|------|------|
| 管理员认证 | 账号密码登录、MFA、会话管理、登录日志 |
| 仪表盘 | 关键指标、趋势图表、实时动态 |
| 用户管理 | 用户列表、详情、禁用/启用、调整订阅 |
| 订阅管理 | 计划管理、订阅列表、订单管理 |
| 操作日志 | 日志列表、筛选、导出 |

#### 第二期 (P1)

| 模块 | 功能 |
|------|------|
| 技能商店管理 | 技能审核、上下架、分类、推荐 |
| 系统监控 | 服务状态、API监控、资源使用、实时日志 |

#### 第三期 (P2)

| 模块 | 功能 |
|------|------|
| 系统配置 | 基础配置、功能开关、安全配置、通知模板 |
| 数据分析 | 用户分析、收入分析、技能分析、自定义报表 |

### 3.3 页面结构

```
apps/admin-console/
├── src/
│   ├── pages/
│   │   ├── auth/
│   │   │   └── LoginPage.tsx
│   │   ├── dashboard/
│   │   │   └── DashboardPage.tsx
│   │   ├── users/
│   │   │   ├── UserListPage.tsx
│   │   │   └── UserDetailPage.tsx
│   │   ├── subscriptions/
│   │   │   ├── PlanListPage.tsx
│   │   │   ├── SubscriptionListPage.tsx
│   │   │   └── OrderListPage.tsx
│   │   ├── skills/
│   │   │   ├── SkillsPage.tsx
│   │   │   ├── CategoriesPage.tsx
│   │   │   └── FeaturedPage.tsx
│   │   ├── monitor/
│   │   │   ├── MonitorPage.tsx
│   │   │   ├── LogsPage.tsx
│   │   │   └── AlertsPage.tsx
│   │   ├── config/
│   │   │   ├── SiteConfigPage.tsx
│   │   │   ├── FeaturesConfigPage.tsx
│   │   │   └── SecurityConfigPage.tsx
│   │   ├── analytics/
│   │   │   ├── UsersAnalyticsPage.tsx
│   │   │   ├── RevenueAnalyticsPage.tsx
│   │   │   └── SkillsAnalyticsPage.tsx
│   │   └── logs/
│   │       └── AuditLogPage.tsx
│   ├── components/
│   │   ├── ui/              # shadcn/ui 组件
│   │   ├── layout/          # 布局组件
│   │   └── common/          # 通用组件
│   ├── hooks/
│   ├── services/
│   └── stores/
```

### 3.4 仪表盘设计

#### 关键指标卡片

| 指标 | 说明 | 数据源 |
|------|------|--------|
| 总用户数 | 平台注册用户总数 | users 表 COUNT |
| 今日新增 | 今日注册用户数 | users 表 WHERE created_at >= today |
| 活跃用户 (7日) | 近 7 天有登录的用户 | users 表 WHERE last_login_at >= 7 days ago |
| 付费用户 | 有有效订阅的用户数 | subscriptions 表 WHERE status = 'active' |
| 本月收入 | 当月订阅收入 | orders 表 WHERE status = 'paid' |
| 在线设备 | 当前在线设备数 | devices 表 WHERE status = 'online' |

#### 图表

| 图表 | 类型 | 说明 |
|------|------|------|
| 用户增长趋势 | 折线图 | 近 30 天每日新增用户 |
| 订阅分布 | 饼图 | 按计划类型分布 |
| 收入趋势 | 柱状图 | 近 12 个月收入 |

### 3.5 管理员 API 设计

#### 认证 API

```
POST /api/admin/v1/auth/login       # 管理员登录
POST /api/admin/v1/auth/mfa/verify  # MFA 验证
POST /api/admin/v1/auth/refresh     # 刷新令牌
POST /api/admin/v1/auth/logout      # 登出
```

#### 仪表盘 API

```
GET /api/admin/v1/dashboard/stats       # 统计概览
GET /api/admin/v1/dashboard/trends      # 趋势数据
GET /api/admin/v1/dashboard/activities  # 实时动态
```

#### 用户管理 API

```
GET    /api/admin/v1/users              # 用户列表
GET    /api/admin/v1/users/:id          # 用户详情
PATCH  /api/admin/v1/users/:id/status   # 更新用户状态
POST   /api/admin/v1/users/:id/reset-password  # 重置密码
POST   /api/admin/v1/users/:id/subscription    # 调整订阅
POST   /api/admin/v1/users/:id/force-logout    # 强制登出
POST   /api/admin/v1/users/export       # 导出用户
```

#### 订阅管理 API

```
GET    /api/admin/v1/subscription-plans     # 计划列表
POST   /api/admin/v1/subscription-plans     # 创建计划
PUT    /api/admin/v1/subscription-plans/:id # 更新计划
GET    /api/admin/v1/subscriptions          # 订阅列表
GET    /api/admin/v1/orders                 # 订单列表
POST   /api/admin/v1/orders/:id/refund      # 处理退款
```

#### 操作日志 API

```
GET  /api/admin/v1/audit-logs        # 日志列表
POST /api/admin/v1/audit-logs/export # 导出日志
```

---

## 4. 数据库设计

### 4.1 管理员表

```sql
CREATE TABLE admins (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  username VARCHAR(50) NOT NULL UNIQUE,
  password_hash VARCHAR(255) NOT NULL,
  display_name VARCHAR(100) NOT NULL,
  email VARCHAR(255),
  phone VARCHAR(20),
  avatar_url VARCHAR(500),
  role VARCHAR(20) NOT NULL DEFAULT 'operator',
  status VARCHAR(20) NOT NULL DEFAULT 'active',
  mfa_enabled BOOLEAN DEFAULT FALSE,
  mfa_secret VARCHAR(100),
  last_login_at TIMESTAMPTZ,
  last_login_ip VARCHAR(50),
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  created_by UUID REFERENCES admins(id)
);
```

### 4.2 管理员会话表

```sql
CREATE TABLE admin_sessions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  admin_id UUID NOT NULL REFERENCES admins(id) ON DELETE CASCADE,
  token_hash VARCHAR(255) NOT NULL,
  ip_address VARCHAR(50),
  user_agent TEXT,
  expires_at TIMESTAMPTZ NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  last_active_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 4.3 管理员操作日志表

```sql
CREATE TABLE admin_audit_logs (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  admin_id UUID NOT NULL REFERENCES admins(id),
  admin_name VARCHAR(100) NOT NULL,
  action VARCHAR(100) NOT NULL,
  resource_type VARCHAR(50) NOT NULL,
  resource_id VARCHAR(100),
  before_data JSONB,
  after_data JSONB,
  reason TEXT,
  ip_address VARCHAR(50),
  user_agent TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

### 4.4 每日统计表

```sql
CREATE TABLE daily_stats (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  date DATE NOT NULL UNIQUE,
  new_users INTEGER DEFAULT 0,
  active_users INTEGER DEFAULT 0,
  new_subscriptions INTEGER DEFAULT 0,
  revenue INTEGER DEFAULT 0,
  api_calls INTEGER DEFAULT 0,
  online_devices INTEGER DEFAULT 0,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

## 5. 安全设计

### 5.1 认证安全

| 安全措施 | 说明 |
|----------|------|
| 独立认证系统 | 管理员账号与用户账号完全隔离 |
| 强密码策略 | 最少 12 位，包含大小写字母、数字、特殊字符 |
| MFA 二次验证 | 支持 TOTP，超级管理员强制启用 |
| 会话超时 | 1 小时无操作自动登出 |
| 登录尝试限制 | 5 次失败后锁定 30 分钟 |
| IP 白名单 | 可选的 IP 白名单限制 |

### 5.2 权限控制

| 角色 | 权限范围 |
|------|----------|
| super_admin | 所有权限 |
| admin | 除系统配置外的所有权限 |
| operator | 只读权限 + 部分写权限 |

### 5.3 数据脱敏

| 字段 | 脱敏规则 | 示例 |
|------|----------|------|
| 手机号 | 隐藏中间 4 位 | 138****8000 |
| 邮箱 | 隐藏 @ 前部分 | u***@example.com |
| 身份证 | 隐藏中间 10 位 | 110***********1234 |

### 5.4 审计日志

所有敏感操作记录审计日志：

| 操作类型 | 说明 |
|----------|------|
| admin.login | 管理员登录 |
| admin.logout | 管理员登出 |
| user.view | 查看用户详情 |
| user.suspend | 禁用用户 |
| user.activate | 启用用户 |
| user.password_reset | 重置用户密码 |
| user.subscription_adjust | 调整用户订阅 |
| plan.create | 创建订阅计划 |
| plan.update | 更新订阅计划 |
| order.refund | 处理退款 |
| export.users | 导出用户数据 |

---

## 6. 部署架构

### 6.1 开发环境

```
┌─────────────────────────────────────────────────────────────────┐
│                        开发环境                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────────────┐         ┌─────────────────┐              │
│   │   Vite Dev      │  proxy  │   Gateway       │              │
│   │   localhost:5173│ ──────► │   localhost:18789│             │
│   └─────────────────┘         └─────────────────┘              │
│                                       │                         │
│                                       ▼                         │
│                               ┌─────────────────┐              │
│                               │   PostgreSQL    │              │
│                               │   localhost:5432│              │
│                               └─────────────────┘              │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 6.2 生产环境

```
┌─────────────────────────────────────────────────────────────────┐
│                        生产环境                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────────────┐         ┌─────────────────┐              │
│   │   CDN/Nginx     │         │   API Gateway   │              │
│   │   admin.xxx.com │ ──────► │   api.xxx.com   │              │
│   └─────────────────┘         └────────┬────────┘              │
│                                        │                        │
│                                        ▼                        │
│                               ┌─────────────────┐              │
│                               │   Gateway 服务   │              │
│                               │   (内网)         │              │
│                               └────────┬────────┘              │
│                                        │                        │
│            ┌───────────────────────────┼───────────────────┐   │
│            ▼                           ▼                   ▼   │
│   ┌─────────────────┐         ┌─────────────────┐ ┌──────────┐│
│   │   PostgreSQL    │         │   Redis         │ │ 日志存储  ││
│   └─────────────────┘         └─────────────────┘ └──────────┘│
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 7. TypeScript 类型定义

### 7.1 管理员类型

```typescript
interface Admin {
  id: string;
  username: string;
  displayName: string;
  email?: string;
  phone?: string;
  avatarUrl?: string;
  role: 'super_admin' | 'admin' | 'operator';
  status: 'active' | 'disabled';
  mfaEnabled: boolean;
  lastLoginAt?: string;
  createdAt: string;
}
```

### 7.2 审计日志类型

```typescript
interface AuditLog {
  id: string;
  admin: {
    id: string;
    displayName: string;
  };
  action: string;
  resourceType: string;
  resourceId?: string;
  before?: Record<string, unknown>;
  after?: Record<string, unknown>;
  reason?: string;
  ipAddress: string;
  createdAt: string;
}
```

### 7.3 统计类型

```typescript
interface DashboardStats {
  totalUsers: number;
  newUsersToday: number;
  activeUsers7d: number;
  paidUsers: number;
  revenueThisMonth: number;
  onlineDevices: number;
  apiCallsToday: number;
}

interface TrendData {
  labels: string[];
  values: number[];
}
```

---

## 8. 环境变量

```bash
# apps/web-admin/.env
VITE_API_BASE_URL=http://localhost:18789
VITE_APP_TITLE=OpenClaw

# apps/admin-console/.env
VITE_API_BASE_URL=http://localhost:18789
VITE_APP_TITLE=OpenClaw Admin
```

---

*— 文档结束 —*

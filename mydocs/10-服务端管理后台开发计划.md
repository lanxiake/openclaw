# OpenClaw 服务端管理后台 - 开发计划

> 版本: 2.5 | 更新日期: 2026-02-07 | 状态: **第三期开发完成**

---

## 0. 当前进度概览

### 已完成模块

| 模块 | 状态 | 完成度 |
|------|------|--------|
| 项目初始化 | ✅ 完成 | 100% |
| 数据库 Schema | ✅ 完成 | 100% |
| 认证系统后端 | ✅ 完成 | 100% |
| 认证系统前端 | ✅ 完成 | 100% |
| 布局组件 | ✅ 完成 | 100% |
| 用户管理后端 | ✅ 完成 | 100% |
| 订阅管理后端 | ✅ 完成 | 100% |
| 审计日志后端 | ✅ 完成 | 100% |
| **仪表盘后端** | ✅ 完成 | 100% |
| **仪表盘前端集成** | ✅ 完成 | 100% |
| **用户管理前端集成** | ✅ 完成 | 100% |
| **订阅管理前端集成** | ✅ 完成 | 100% |
| **审计日志前端集成** | ✅ 完成 | 100% |
| **技能商店管理后端** | ✅ 完成 | 100% |
| **技能商店管理前端** | ✅ 完成 | 100% |
| **系统监控后端** | ✅ 完成 | 100% |
| **系统监控前端** | ✅ 完成 | 100% |
| **系统配置后端** | ✅ 完成 | 100% |
| **系统配置前端** | ✅ 完成 | 100% |
| **数据分析后端** | ✅ 完成 | 100% |
| **数据分析前端** | ✅ 完成 | 100% |

### 待完成模块

所有计划模块已全部完成。

---

## 1. 项目概述

### 1.1 项目信息

| 项目 | 说明 |
|------|------|
| 项目名称 | OpenClaw Admin Console |
| 项目路径 | `apps/admin-console` |
| 技术栈 | React 18 + TypeScript + Vite + shadcn/ui |
| 设计文档 | `mydocs/09-服务端管理后台设计.md` |

### 1.2 开发范围

#### 第一期 (P0) - 核心功能 ✅ 已完成

| 模块 | 功能 | 后端 | 前端 |
|------|------|------|------|
| 认证系统 | 管理员登录、会话管理 | ✅ | ✅ |
| 仪表盘 | 关键指标、趋势图表、实时动态 | ✅ | ✅ |
| 用户管理 | 列表、详情、禁用/启用、调整订阅 | ✅ | ✅ |
| 订阅管理 | 计划管理、订阅列表、订单管理 | ✅ | ✅ |
| 操作日志 | 日志列表、筛选、导出 | ✅ | ✅ |

#### 第二期 (P1) - 扩展功能

| 模块 | 功能 | 后端 | 前端 |
|------|------|------|------|
| 技能商店管理 | 技能审核、上下架、分类、推荐 | ❌ | ❌ |
| 系统监控 | 服务状态、API监控、资源使用、实时日志 | ❌ | ❌ |

#### 第三期 (P2) - 高级功能

| 模块 | 功能 | 后端 | 前端 |
|------|------|------|------|
| 系统配置 | 基础配置、功能开关、安全配置、通知模板 | ❌ | ❌ |
| 数据分析 | 用户分析、收入分析、技能分析、自定义报表 | ❌ | ❌ |

---

## 2. 已完成开发任务

### Phase A: 仪表盘模块 ✅

#### A.1 仪表盘后端 API

| 任务 | RPC 方法 | 状态 |
|------|----------|------|
| 统计概览 API | `admin.dashboard.stats` | ✅ |
| 趋势数据 API | `admin.dashboard.trends` | ✅ |
| 订阅分布 API | `admin.dashboard.subscriptionDistribution` | ✅ |
| 实时动态 API | `admin.dashboard.activities` | ✅ |

#### A.2 仪表盘前端集成

| 任务 | 状态 |
|------|------|
| 创建 dashboard hooks | ✅ |
| 接入统计卡片数据 | ✅ |
| 实现趋势图表 (Recharts) | ✅ |
| 实现分布图表 (饼图) | ✅ |
| 实现实时动态 | ✅ |

### Phase B: 用户管理前端集成 ✅

| 任务 | 状态 |
|------|------|
| 创建 useUsers hooks | ✅ |
| 用户列表页面集成 | ✅ |
| 用户详情页面集成 | ✅ |
| 用户操作 (暂停/激活/重置密码) | ✅ |

### Phase C: 订阅管理前端集成 ✅

| 任务 | 状态 |
|------|------|
| 创建 useSubscriptions hooks | ✅ |
| 订阅列表页面集成 | ✅ |
| 订阅操作 (取消/延长) | ✅ |
| 订阅统计卡片 | ✅ |

### Phase D: 审计日志前端集成 ✅

| 任务 | 状态 |
|------|------|
| 创建 useAuditLogs hooks | ✅ |
| 日志列表页面集成 | ✅ |
| 日志详情弹窗 | ✅ |
| 统计卡片 | ✅ |

### Phase E: 技能商店管理 ✅

| 任务 | 状态 |
|------|------|
| 类型定义 (types/skill.ts) | ✅ |
| 后端 API (admin-skills.ts) | ✅ |
| 前端 hooks (useSkills.ts) | ✅ |
| 技能列表页面 (SkillsPage.tsx) | ✅ |
| 分类管理页面 (CategoriesPage.tsx) | ✅ |
| 推荐管理页面 (FeaturedPage.tsx) | ✅ |

### Phase F: 系统监控 ✅

| 任务 | 状态 |
|------|------|
| 类型定义 (types/monitor.ts) | ✅ |
| 后端 API (admin-monitor.ts) | ✅ |
| 前端 hooks (useMonitor.ts) | ✅ |
| 监控仪表盘 (MonitorPage.tsx) | ✅ |
| 系统日志页面 (LogsPage.tsx) | ✅ |
| 告警管理页面 (AlertsPage.tsx) | ✅ |
| 工具函数 (formatBytes, formatDuration) | ✅ |

### Phase G: 系统配置 ✅

| 任务 | 状态 |
|------|------|
| 类型定义 (types/config.ts) | ✅ |
| 后端 API (admin-config.ts) | ✅ |
| 前端 hooks (useConfig.ts) | ✅ |
| 配置主页 (ConfigPage.tsx) | ✅ |
| 站点配置页面 (SiteConfigPage.tsx) | ✅ |
| 功能开关页面 (FeaturesConfigPage.tsx) | ✅ |
| 安全配置页面 (SecurityConfigPage.tsx) | ✅ |
| 通知模板页面 (NotificationsConfigPage.tsx) | ✅ |
| Tabs 组件 (tabs.tsx) | ✅ |

### Phase H: 数据分析 ✅

| 任务 | 状态 |
|------|------|
| 类型定义 (types/analytics.ts) | ✅ |
| 后端 API (admin-analytics.ts) | ✅ |
| 前端 hooks (useAnalytics.ts) | ✅ |
| 分析主页 (AnalyticsPage.tsx) | ✅ |
| 用户分析页面 (UsersAnalyticsPage.tsx) | ✅ |
| 收入分析页面 (RevenueAnalyticsPage.tsx) | ✅ |
| 技能分析页面 (SkillsAnalyticsPage.tsx) | ✅ |
| 漏斗分析页面 (FunnelsAnalyticsPage.tsx) | ✅ |

---

## 3. 技术架构

### 2.1 前端技术栈

```
React 18.x          - UI 框架
TypeScript 5.x      - 类型安全
Vite 5.x            - 构建工具
React Router 6.x    - 路由
TanStack Query 5.x  - 数据获取
Zustand 4.x         - 状态管理
shadcn/ui           - UI 组件库
Tailwind CSS 3.x    - 样式
Recharts 2.x        - 图表
React Hook Form 7.x - 表单
Zod 3.x             - 验证
```

### 2.2 后端技术栈

```
已有 Gateway 服务    - 复用现有架构
PostgreSQL          - 数据库
Drizzle ORM         - 数据访问
```

### 2.3 项目结构

```
apps/admin-console/
├── public/
├── src/
│   ├── main.tsx
│   ├── App.tsx
│   ├── components/
│   │   ├── ui/              # shadcn/ui 组件
│   │   ├── layout/          # 布局组件
│   │   └── common/          # 通用组件
│   ├── pages/               # 页面
│   ├── services/            # API 服务
│   ├── hooks/               # 自定义 Hooks
│   ├── stores/              # 状态管理
│   ├── routes/              # 路由配置
│   ├── lib/                 # 工具库
│   ├── types/               # 类型定义
│   └── styles/              # 样式
├── package.json
├── vite.config.ts
├── tailwind.config.ts
└── tsconfig.json
```

---

## 3. 开发计划

### 3.1 时间线概览

```
Week 1 (Day 1-5):  项目初始化 + 数据库 + 认证系统 + 仪表盘
Week 2 (Day 6-10): 用户管理 + 订阅管理 + 操作日志 + 测试优化
```

### 3.2 详细任务分解

#### Phase 1: 项目初始化 (Day 1)

| 任务 | 预计时间 | 说明 |
|------|----------|------|
| 创建项目结构 | 1h | 使用 Vite 创建 React + TypeScript 项目 |
| 配置 Tailwind CSS | 30min | 安装和配置 Tailwind |
| 安装 shadcn/ui | 1h | 安装基础组件（Button, Card, Input, Table 等） |
| 配置 ESLint/Prettier | 30min | 代码规范配置 |
| 配置路由 | 30min | React Router 基础配置 |
| 配置 TanStack Query | 30min | 数据获取配置 |
| 配置 Zustand | 30min | 状态管理配置 |

**交付物：**
- [ ] 项目可启动 (`pnpm dev`)
- [ ] 基础目录结构完成
- [ ] 开发环境配置完成

#### Phase 2: 数据库迁移 (Day 2)

| 任务 | 预计时间 | 说明 |
|------|----------|------|
| 创建 admins 表 | 30min | 管理员账号表 |
| 创建 admin_sessions 表 | 30min | 管理员会话表 |
| 创建 admin_audit_logs 表 | 30min | 管理员操作日志表 |
| 创建 subscription_plans 表 | 30min | 订阅计划表 |
| 创建 daily_stats 表 | 30min | 每日统计表 |
| 编写种子数据脚本 | 1h | 初始管理员账号、默认订阅计划 |
| 创建 Drizzle Schema | 1h | TypeScript 类型定义 |

**交付物：**
- [ ] 数据库迁移脚本
- [ ] Drizzle Schema 定义
- [ ] 种子数据脚本
- [ ] 初始管理员账号（admin/Admin@123456）

#### Phase 3: 认证系统后端 (Day 3)

| 任务 | 预计时间 | 说明 |
|------|----------|------|
| 实现登录 API | 2h | `/api/admin/v1/auth/login` |
| 实现 JWT 生成 | 1h | Access Token 生成和验证 |
| 实现会话管理 | 1h | 会话创建、验证、过期处理 |
| 实现登出 API | 30min | `/api/admin/v1/auth/logout` |
| 实现刷新令牌 API | 1h | `/api/admin/v1/auth/refresh` |
| 添加认证中间件 | 1h | Gateway 认证中间件 |

**交付物：**
- [ ] 认证 API 完成
- [ ] JWT 令牌机制
- [ ] 认证中间件

#### Phase 4: 认证系统前端 (Day 4)

| 任务 | 预计时间 | 说明 |
|------|----------|------|
| 创建登录页面 | 2h | 登录表单、错误处理 |
| 创建认证状态管理 | 1h | Zustand authStore |
| 创建路由守卫 | 1h | ProtectedRoute 组件 |
| 创建 API 客户端 | 1h | Axios 配置、拦截器 |
| 创建认证服务 | 1h | auth.ts 服务封装 |
| 实现登出功能 | 30min | 登出按钮和逻辑 |

**交付物：**
- [ ] 登录页面
- [ ] 认证状态管理
- [ ] 路由守卫
- [ ] 登录/登出流程完整

#### Phase 5: 布局组件 (Day 4 续)

| 任务 | 预计时间 | 说明 |
|------|----------|------|
| 创建 AdminLayout | 1h | 主布局组件 |
| 创建 Sidebar | 1h | 侧边栏导航 |
| 创建 Header | 1h | 顶部导航栏 |
| 创建 Breadcrumb | 30min | 面包屑导航 |

**交付物：**
- [ ] 完整的后台布局
- [ ] 响应式设计

#### Phase 6: 仪表盘后端 (Day 5)

| 任务 | 预计时间 | 说明 |
|------|----------|------|
| 实现统计概览 API | 2h | `/api/admin/v1/dashboard/stats` |
| 实现趋势数据 API | 1h | `/api/admin/v1/dashboard/trends` |
| 实现实时动态 API | 1h | `/api/admin/v1/dashboard/activities` |
| 添加统计计算逻辑 | 2h | 用户统计、收入统计等 |

**交付物：**
- [ ] 仪表盘 API 完成
- [ ] 统计数据准确

#### Phase 7: 仪表盘前端 (Day 5 续)

| 任务 | 预计时间 | 说明 |
|------|----------|------|
| 创建 StatCard 组件 | 1h | 统计卡片组件 |
| 创建仪表盘页面 | 2h | 布局和数据展示 |
| 集成 Recharts 图表 | 2h | 趋势图、分布图 |
| 创建实时动态列表 | 1h | 最近活动展示 |

**交付物：**
- [ ] 仪表盘页面完成
- [ ] 图表展示正常

#### Phase 8: 用户管理后端 (Day 6)

| 任务 | 预计时间 | 说明 |
|------|----------|------|
| 实现用户列表 API | 2h | 分页、搜索、筛选 |
| 实现用户详情 API | 1h | 完整用户信息 |
| 实现用户状态更新 API | 1h | 禁用/启用 |
| 实现重置密码 API | 1h | 发送重置链接 |
| 实现订阅调整 API | 1h | 升级/降级/续期 |
| 实现强制登出 API | 30min | 登出所有设备 |
| 实现用户导出 API | 1h | CSV 导出 |

**交付物：**
- [ ] 用户管理 API 完成
- [ ] 操作日志记录

#### Phase 9: 用户管理前端 (Day 7)

| 任务 | 预计时间 | 说明 |
|------|----------|------|
| 创建 DataTable 组件 | 2h | 通用数据表格 |
| 创建 SearchInput 组件 | 30min | 搜索输入框 |
| 创建 StatusBadge 组件 | 30min | 状态徽章 |
| 创建用户列表页面 | 2h | 列表展示 |
| 创建用户详情页面 | 2h | 详情展示 |
| 创建 ConfirmDialog 组件 | 1h | 确认对话框 |
| 实现用户操作功能 | 2h | 禁用、重置密码等 |

**交付物：**
- [ ] 用户列表页面
- [ ] 用户详情页面
- [ ] 用户操作功能

#### Phase 10: 订阅管理后端 (Day 8)

| 任务 | 预计时间 | 说明 |
|------|----------|------|
| 实现计划列表 API | 1h | 获取所有计划 |
| 实现计划创建 API | 1h | 创建新计划 |
| 实现计划更新 API | 1h | 更新计划信息 |
| 实现订阅列表 API | 1h | 分页、筛选 |
| 实现订单列表 API | 1h | 分页、筛选 |
| 实现退款处理 API | 1h | 退款逻辑 |

**交付物：**
- [ ] 订阅管理 API 完成

#### Phase 11: 订阅管理前端 (Day 9)

| 任务 | 预计时间 | 说明 |
|------|----------|------|
| 创建计划列表页面 | 2h | 计划展示和编辑 |
| 创建订阅列表页面 | 2h | 订阅展示 |
| 创建订单列表页面 | 2h | 订单展示 |
| 实现退款功能 | 1h | 退款操作 |

**交付物：**
- [ ] 订阅管理页面完成

#### Phase 12: 操作日志 (Day 10)

| 任务 | 预计时间 | 说明 |
|------|----------|------|
| 实现日志列表 API | 1h | 分页、筛选 |
| 实现日志导出 API | 1h | CSV 导出 |
| 创建操作日志页面 | 2h | 日志展示 |
| 创建日志详情弹窗 | 1h | 详情查看 |
| 实现日志导出功能 | 1h | 导出下载 |

**交付物：**
- [ ] 操作日志页面完成
- [ ] 日志导出功能

#### Phase 13: 测试和优化 (Day 10 续)

| 任务 | 预计时间 | 说明 |
|------|----------|------|
| 功能测试 | 2h | 全流程测试 |
| Bug 修复 | 2h | 修复发现的问题 |
| 性能优化 | 1h | 加载优化 |
| 文档更新 | 1h | 更新设计文档 |

**交付物：**
- [ ] 所有功能正常
- [ ] 无严重 Bug

---

## 4. 里程碑

| 里程碑 | 日期 | 交付物 |
|--------|------|--------|
| M1: 项目初始化 | Day 1 | 项目结构、开发环境 |
| M2: 数据库就绪 | Day 2 | 数据库迁移、种子数据 |
| M3: 认证系统完成 | Day 4 | 登录/登出功能 |
| M4: 仪表盘完成 | Day 5 | 仪表盘页面 |
| M5: 用户管理完成 | Day 7 | 用户管理功能 |
| M6: 订阅管理完成 | Day 9 | 订阅管理功能 |
| M7: 第一期完成 | Day 10 | 全部功能、测试通过 |

---

## 5. 依赖和风险

### 5.1 技术依赖

| 依赖 | 说明 | 状态 |
|------|------|------|
| PostgreSQL | 数据库 | 已有 |
| Gateway 服务 | API 服务 | 已有 |
| 用户表 (users) | 用户数据 | 已有 |
| 订阅表 (subscriptions) | 订阅数据 | 需确认 |

### 5.2 风险识别

| 风险 | 影响 | 概率 | 缓解措施 |
|------|------|------|----------|
| 现有数据库 Schema 不匹配 | 中 | 中 | 提前检查现有表结构 |
| Gateway API 改动 | 低 | 低 | 独立的管理员 API 路由 |
| 前端组件复杂度 | 低 | 中 | 复用 shadcn/ui 组件 |

---

## 6. 开发规范

### 6.1 代码规范

- 使用 TypeScript 严格模式
- 遵循 ESLint + Prettier 配置
- 组件使用函数式组件 + Hooks
- API 调用使用 TanStack Query
- 状态管理使用 Zustand

### 6.2 命名规范

| 类型 | 规范 | 示例 |
|------|------|------|
| 组件 | PascalCase | `UserListPage.tsx` |
| Hook | camelCase + use 前缀 | `useUsers.ts` |
| 服务 | camelCase | `userService.ts` |
| 类型 | PascalCase | `User`, `ApiResponse` |
| 常量 | UPPER_SNAKE_CASE | `API_BASE_URL` |

### 6.3 Git 规范

```
feat: 新功能
fix: Bug 修复
refactor: 重构
docs: 文档
style: 样式
test: 测试
chore: 构建/工具
```

---

## 7. 验收标准

### 7.1 功能验收

| 功能 | 验收标准 |
|------|----------|
| 登录 | 正确的账号密码可以登录，错误的会提示 |
| 仪表盘 | 统计数据显示正确，图表正常渲染 |
| 用户列表 | 支持分页、搜索、筛选，数据正确 |
| 用户详情 | 显示完整用户信息，设备列表正确 |
| 用户操作 | 禁用/启用/重置密码功能正常，有确认弹窗 |
| 订阅计划 | 可查看、编辑订阅计划 |
| 操作日志 | 所有敏感操作都有日志记录 |

### 7.2 非功能验收

| 指标 | 标准 |
|------|------|
| 页面加载时间 | < 3s |
| API 响应时间 | < 500ms (P95) |
| 构建产物大小 | < 500KB (gzip) |
| 浏览器兼容 | Chrome, Firefox, Edge 最新版 |

---

## 8. 执行清单

### Day 1 清单

```
□ 创建 apps/admin-console 目录
□ 初始化 Vite + React + TypeScript 项目
□ 配置 Tailwind CSS
□ 安装 shadcn/ui (button, card, input, table, dialog, dropdown-menu)
□ 配置 React Router
□ 配置 TanStack Query
□ 配置 Zustand
□ 创建基础目录结构
□ 验证项目可启动
```

### Day 2 清单

```
□ 设计数据库表结构
□ 创建 Drizzle Schema
□ 编写数据库迁移脚本
□ 执行迁移
□ 编写种子数据脚本
□ 创建初始管理员账号
□ 验证数据库表正确创建
```

### Day 3-4 清单

```
□ 实现管理员登录 API
□ 实现 JWT 令牌生成
□ 实现会话管理
□ 实现登出 API
□ 创建登录页面 UI
□ 创建 authStore
□ 创建 ProtectedRoute
□ 创建 API 客户端
□ 创建 AdminLayout
□ 创建 Sidebar
□ 创建 Header
□ 验证登录流程
```

### Day 5 清单

```
□ 实现仪表盘统计 API
□ 实现趋势数据 API
□ 实现实时动态 API
□ 创建 StatCard 组件
□ 创建仪表盘页面
□ 集成图表
□ 验证数据显示正确
```

### Day 6-7 清单

```
□ 实现用户列表 API
□ 实现用户详情 API
□ 实现用户操作 API
□ 创建 DataTable 组件
□ 创建用户列表页面
□ 创建用户详情页面
□ 实现用户操作功能
□ 验证用户管理功能
```

### Day 8-9 清单

```
□ 实现订阅计划 API
□ 实现订阅列表 API
□ 实现订单 API
□ 创建计划管理页面
□ 创建订阅列表页面
□ 创建订单列表页面
□ 验证订阅管理功能
```

### Day 10 清单

```
□ 实现操作日志 API
□ 创建操作日志页面
□ 实现日志导出
□ 全流程功能测试
□ Bug 修复
□ 更新文档
□ 最终验收
```

---

## 附录: 命令参考

```bash
# 创建项目
pnpm create vite apps/admin-console --template react-ts

# 安装依赖
cd apps/admin-console
pnpm add react-router-dom @tanstack/react-query zustand
pnpm add -D tailwindcss postcss autoprefixer
pnpm add recharts react-hook-form @hookform/resolvers zod
pnpm add lucide-react clsx tailwind-merge

# 初始化 Tailwind
npx tailwindcss init -p

# 初始化 shadcn/ui
npx shadcn-ui@latest init

# 添加 shadcn 组件
npx shadcn-ui@latest add button card input table dialog dropdown-menu

# 启动开发服务器
pnpm dev

# 构建
pnpm build
```

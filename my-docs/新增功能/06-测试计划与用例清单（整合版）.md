# OpenClaw AI ä¸ªäººåŠ©ç†å¹³å° - å…¨é‡æµ‹è¯•è®¡åˆ’ä¸ç”¨ä¾‹æ¸…å•

> ç‰ˆæœ¬: 3.0 | åˆ›å»ºæ—¥æœŸ: 2026-02-08 | æ›´æ–°æ—¥æœŸ: 2026-02-11 | çŠ¶æ€: æ‰§è¡Œä¸­
>
> æœ¬æ–‡æ¡£æ˜¯å”¯ä¸€æµ‹è¯•åŸºçº¿ï¼Œæ¶µç›–æµ‹è¯•æŒ‡å¯¼ã€æ‰§è¡Œç­–ç•¥ã€è¯¦ç»†ç”¨ä¾‹åŠåº”ç”¨åŠŸèƒ½æ¸…å•ã€‚

---

## ä¿®è®¢è®°å½•

| ç‰ˆæœ¬ | æ—¥æœŸ       | ä¿®è®¢å†…å®¹ |
| ---- | ---------- | -------- |
| 1.0  | 2026-02-08 | åˆå§‹ç‰ˆæœ¬ï¼ˆåŸ 06-æµ‹è¯•è®¡åˆ’ + 07-æµ‹è¯•ç”¨ä¾‹è¯¦ç»†æ¸…å•ï¼‰ |
| 1.1  | 2026-02-08 | å®Œæˆå¯†ç å·¥å…·å’Œ JWT å·¥å…·æµ‹è¯• |
| 1.2  | 2026-02-08 | åˆ›å»ºç”¨æˆ·ä»“åº“æµ‹è¯•ï¼Œå‘ç° Mock æ•°æ®åº“é—®é¢˜ |
| 1.3  | 2026-02-08 | ä¿®å¤ Mock æ•°æ®åº“ Promise æ¥å£ï¼Œéƒ¨åˆ†æµ‹è¯•é€šè¿‡ |
| 2.0  | 2026-02-10 | æ•´åˆ 06+07ï¼Œæ–°å¢ admin-console / web-admin / windows åŠŸèƒ½æµ‹è¯•æ¸…å• |
| 2.1  | 2026-02-10 | å¢åŠ æµ‹è¯•æŒ‡å¯¼ï¼ˆç¼–å†™è§„èŒƒã€æ‰§è¡Œé¡ºåºã€æ›´æ–°æµç¨‹ï¼‰ï¼Œå®Œå–„å…¨éƒ¨æµ‹è¯•ç”¨ä¾‹ |
| 2.2  | 2026-02-10 | å®Œæˆç®¡ç†å‘˜è®¤è¯é›†æˆæµ‹è¯•ï¼Œä¿®å¤ 3 ä¸ª Schema é—®é¢˜ï¼Œåˆ›å»ºé›†æˆæµ‹è¯•æŠ¥å‘Š |
| 2.3  | 2026-02-11 | å®Œæˆé˜¶æ®µ1~3å…¨éƒ¨æµ‹è¯•ï¼šutils(9) + repos(78) + services(97)ï¼Œå…±184ç”¨ä¾‹å…¨éƒ¨é€šè¿‡ |
| 2.4  | 2026-02-11 | å®Œæˆé˜¶æ®µ4 Gatewayæµ‹è¯•ï¼šå•å…ƒ209é€šè¿‡ + E2E 103é€šè¿‡/9å¤±è´¥/2è·³è¿‡ï¼Œå…±526ç”¨ä¾‹ |
| 2.5  | 2026-02-11 | å®Œæˆé˜¶æ®µB å‰ç«¯æµè§ˆå™¨æµ‹è¯•ï¼šadmin-console 18/18é€šè¿‡ + web-admin 17/17é€šè¿‡ï¼Œä¿®å¤2ä¸ªå‰ç«¯bug |
| 2.6  | 2026-02-11 | ä¿®å¤ Gateway E2E å…¨éƒ¨9ä¸ªå¤±è´¥ç”¨ä¾‹ï¼šhealth tokenåŒæ­¥ã€hooks/reloadè¶…æ—¶ã€sessions-sendè®¤è¯ã€chat agentCommandå¯¼å…¥ã€chat slash commandæ ‡è®°ã€chat-b orderingç«äº‰æ¡ä»¶ |
| 2.7  | 2026-02-11 | å®ç°å‰ç«¯JWTè¿‡æœŸæ£€æŸ¥ä¸è‡ªåŠ¨åˆ·æ–°(web-admin+admin-console)ï¼ŒAC-AUTH-005é€šè¿‡(18/18)ï¼Œä¿®å¤è®¢é˜…é¡µ/å®¡è®¡æ—¥å¿—é¡µnull guardå´©æºƒ |
| 2.8  | 2026-02-11 | å®ŒæˆP1å‰ç«¯æµè§ˆå™¨æµ‹è¯•ï¼šadmin-console 10/10é€šè¿‡(ä»ªè¡¨ç›˜+æŠ€èƒ½+å®¡è®¡+é…ç½®+è®¢é˜…è®¡åˆ’)ï¼Œweb-admin 5/5é€šè¿‡(è®¾ç½®+ç®¡ç†å‘˜) |
| 2.9  | 2026-02-11 | å®ŒæˆP2å‰ç«¯æµè§ˆå™¨æµ‹è¯•ï¼šadmin-console 11/11é€šè¿‡(æŠ€èƒ½åˆ†ç±»+å®¡è®¡å¯¼å‡º+ç³»ç»Ÿç›‘æ§+åŠŸèƒ½å¼€å…³+æ•°æ®åˆ†æ5é¡¹)ï¼Œadmin-consoleå…¨é‡39/39 |
| 3.0  | 2026-02-11 | å®ŒæˆWindowsæ¡Œé¢UIæµè§ˆå™¨æµ‹è¯•ï¼šWIN-UI-001~014å…¨éƒ¨14/14é€šè¿‡(Playwright+electronAPI Mock+Vite dev server)ï¼Œä¿®å¤SubscriptionView/AuditLogViewæ¸²æŸ“è¶…æ—¶ |

---

## ç›®å½•

- [ç¬¬ä¸€éƒ¨åˆ†ï¼šæµ‹è¯•æŒ‡å¯¼](#ç¬¬ä¸€éƒ¨åˆ†æµ‹è¯•æŒ‡å¯¼)
- [ç¬¬äºŒéƒ¨åˆ†ï¼šæµ‹è¯•æ¦‚è¿°ä¸ç­–ç•¥](#ç¬¬äºŒéƒ¨åˆ†æµ‹è¯•æ¦‚è¿°ä¸ç­–ç•¥)
- [ç¬¬ä¸‰éƒ¨åˆ†ï¼šæµ‹è¯•ç¯å¢ƒä¸ Mock ç­–ç•¥](#ç¬¬ä¸‰éƒ¨åˆ†æµ‹è¯•ç¯å¢ƒä¸-mock-ç­–ç•¥)
- [ç¬¬å››éƒ¨åˆ†ï¼šæµ‹è¯•æ‰§è¡Œé¡ºåº](#ç¬¬å››éƒ¨åˆ†æµ‹è¯•æ‰§è¡Œé¡ºåº)
- [ç¬¬äº”éƒ¨åˆ†ï¼šåç«¯è¯¦ç»†æµ‹è¯•ç”¨ä¾‹](#ç¬¬äº”éƒ¨åˆ†åç«¯è¯¦ç»†æµ‹è¯•ç”¨ä¾‹)
- [ç¬¬å…­éƒ¨åˆ†ï¼šåº”ç”¨åŠŸèƒ½æµ‹è¯•æ¸…å•](#ç¬¬å…­éƒ¨åˆ†åº”ç”¨åŠŸèƒ½æµ‹è¯•æ¸…å•)
- [ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæµ‹è¯•è¿›åº¦è·Ÿè¸ª](#ç¬¬ä¸ƒéƒ¨åˆ†æµ‹è¯•è¿›åº¦è·Ÿè¸ª)
- [ç¬¬å…«éƒ¨åˆ†ï¼šé—®é¢˜è·Ÿè¸ªä¸éªŒæ”¶æ ‡å‡†](#ç¬¬å…«éƒ¨åˆ†é—®é¢˜è·Ÿè¸ªä¸éªŒæ”¶æ ‡å‡†)

---

## æµ‹è¯•è¿›åº¦ç»Ÿè®¡

**æœ€åæ›´æ–°**: 2026-02-11 18:30

| æŒ‡æ ‡            | æ•°å€¼                    |
| --------------- | ----------------------- |
| å·²å®Œæˆæµ‹è¯•æ–‡ä»¶  | 10 + 33(unit) + 21(e2e) + 8(browser) = 72 |
| å·²é€šè¿‡æµ‹è¯•ç”¨ä¾‹  | 214 + 209 + 112 + 75 = 610 |
| å¤±è´¥æµ‹è¯•ç”¨ä¾‹    | 0                           |
| å½“å‰ä»£ç è¦†ç›–ç‡  | ~25% (åç«¯æœåŠ¡ + Gateway) |
| P0 ä¼˜å…ˆçº§å®Œæˆåº¦ | 100% (7/7)              |
| å‰ç«¯æµè§ˆå™¨æµ‹è¯•  | admin-console 39/39 âœ… web-admin 22/22 âœ… |
| æ¡Œé¢æµ‹è¯•        | Windows UI 14/14 âœ…     |
| Schema é—®é¢˜     | 3 ä¸ªå·²ä¿®å¤              |
| Mock DB é—®é¢˜    | 2 ä¸ªå·²ä¿®å¤ (èšåˆæ£€æµ‹ + getDatabase é€ä¼ ) |
| å‰ç«¯ Bug ä¿®å¤   | 2 ä¸ªå·²ä¿®å¤ (hasScope + features æ¸²æŸ“) |
| Gateway ä¿®å¤    | 7 ä¸ªå·²ä¿®å¤ (E2Eæµ‹è¯• + slash commandæ ‡è®°) |

**å·²å®Œæˆ**: âœ… å¯†ç å·¥å…· (12/12) âœ… JWT å·¥å…· (18/18) âœ… ID ç”Ÿæˆ (9/9) âœ… ç”¨æˆ·ä»“åº“ (22/22) âœ… ç®¡ç†å‘˜ä»“åº“ (20/20) âœ… è®¢é˜…ä»“åº“ (36/36) âœ… ç”¨æˆ·è®¤è¯æœåŠ¡ (21/21) âœ… ç®¡ç†å‘˜è®¤è¯æœåŠ¡ (20/20) âœ… è®¢é˜…æœåŠ¡ (31/31) âœ… æŠ€èƒ½æœåŠ¡ (25/25)
**Gateway**: âœ… å•å…ƒæµ‹è¯• (209/209) âœ… E2Eæµ‹è¯• (112/114, 2 skipped, 0 failed)
**æµè§ˆå™¨æµ‹è¯•**: âœ… admin-console è®¤è¯ (5/5) âœ… admin-console ç”¨æˆ·ç®¡ç† (5/5) âœ… admin-console è®¢é˜…+Gateway (8/8) âœ… admin-console P1 (10/10) âœ… admin-console P2 (11/11) âœ… web-admin å…¨é‡ (17/17) âœ… web-admin P1 (5/5) âœ… Windows UI (14/14)
**åŸºç¡€è®¾æ–½ä¿®å¤**: âœ… Mock DB where æ¡ä»¶è§£æå™¨ âœ… Mock DB èšåˆæ£€æµ‹ (count) âœ… getDatabase() mock æ¨¡å¼é€ä¼ 
**Schema ä¿®å¤**: âœ… admin_audit_logs è¡¨ï¼ˆæ·»åŠ  admin_username åˆ—ï¼Œæ‰©å±• ID é•¿åº¦ï¼Œåˆ é™¤ NOT NULL çº¦æŸï¼‰
**å‰ç«¯ä¿®å¤**: âœ… web-admin authStore ç¼ºå°‘ hasScope æ–¹æ³• âœ… web-admin è®¢é˜…é¡µé¢ features å¯¹è±¡æ¸²æŸ“é”™è¯¯ âœ… è®¢é˜…é¡µé¢ null guard âœ… å®¡è®¡æ—¥å¿— null guard âœ… JWT Token è¿‡æœŸæ£€æŸ¥
**Gateway E2E ä¿®å¤**: âœ… health tokenåŒæ­¥ âœ… hooks/reloadè¶…æ—¶å¢å¤§ âœ… sessions-sendè®¤è¯åŒæ­¥ âœ… chat agentCommandå¯¼å…¥ âœ… chat slash commandæ ‡è®° âœ… chat-b orderingç«äº‰æ¡ä»¶

---

# ç¬¬ä¸€éƒ¨åˆ†ï¼šæµ‹è¯•æŒ‡å¯¼

> æœ¬ç« ä¸ºæµ‹è¯•äººå‘˜å’Œå¼€å‘äººå‘˜æä¾›ç»Ÿä¸€çš„å·¥ä½œè§„èŒƒã€‚

## 1.1 æµ‹è¯•ç¼–å†™è§„èŒƒ

### æ–‡ä»¶å‘½å

- å•å…ƒæµ‹è¯•ï¼š`<æ¨¡å—å>.test.ts`ï¼Œä¸æºæ–‡ä»¶åŒç›®å½•
- é›†æˆæµ‹è¯•ï¼š`<æ¨¡å—å>.integration.test.ts`
- E2E æµ‹è¯•ï¼š`<æ¨¡å—å>.e2e.test.ts`

### ç”¨ä¾‹ ID è§„åˆ™

æ ¼å¼ï¼š`<æ¨¡å—ç¼©å†™>-<åŠŸèƒ½>-<åºå·>`ï¼Œå¦‚ `AUTH-REG-001`ã€`SUB-CREATE-002`ã€‚

### æµ‹è¯•ç”¨ä¾‹æ¨¡æ¿

æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹å¿…é¡»åŒ…å«ï¼š

```typescript
/**
 * ç”¨ä¾‹ID: AUTH-REG-001
 * åœºæ™¯: æ‰‹æœºå·æ³¨å†ŒæˆåŠŸ
 * å‰ç½®: Mock DB å·²å¯ç”¨ï¼ŒéªŒè¯ç å·²é¢„ç½®
 * è¾“å…¥: { phone, code, password }
 * é¢„æœŸ: { success: true, user, accessToken }
 * æ—¥å¿—: [auth] User registered successfully
 */
it("AUTH-REG-001: åº”è¯¥æˆåŠŸæ³¨å†Œæ‰‹æœºå·ç”¨æˆ·", async () => {
  // Arrange - å‡†å¤‡æµ‹è¯•æ•°æ®
  const request = {
    phone: "+8613800138000",
    code: "123456",
    password: "Test@123",
  };

  // Act - æ‰§è¡Œè¢«æµ‹åŠŸèƒ½
  const result = await register(request);

  // Assert - éªŒè¯ç»“æœ
  expect(result.success).toBe(true);
  expect(result.user?.phone).toBe(request.phone);
  expect(result.accessToken).toBeTruthy();
});
```

### ç¼–å†™åŸåˆ™

1. **AAA æ¨¡å¼**ï¼šæ¯ä¸ªç”¨ä¾‹éµå¾ª Arrange â†’ Act â†’ Assert ç»“æ„
2. **ç‹¬ç«‹æ€§**ï¼šæ¯ä¸ªç”¨ä¾‹ä¸ä¾èµ–å…¶ä»–ç”¨ä¾‹çš„æ‰§è¡Œé¡ºåºï¼Œ`beforeEach` ä¸­æ¸…ç©ºçŠ¶æ€
3. **ç”¨ä¾‹ ID**ï¼šit() æè¿°ä»¥ç”¨ä¾‹ ID å¼€å¤´ï¼Œä¾¿äºæœç´¢å’Œè·Ÿè¸ª
4. **æ—¥å¿—éªŒè¯**ï¼šå¯¹å…³é”®ä¸šåŠ¡æ“ä½œï¼ŒéªŒè¯æ—¥å¿—æ˜¯å¦æ­£ç¡®è¾“å‡º
5. **è¾¹ç•Œè¦†ç›–**ï¼šæ¯ä¸ªå‡½æ•°è‡³å°‘è¦†ç›–æ­£å¸¸è·¯å¾„ + é”™è¯¯è·¯å¾„ + è¾¹ç•Œæ¡ä»¶

### Mock å±‚çº§é€‰æ‹©

| æµ‹è¯•å±‚çº§ | Mock ä»€ä¹ˆ | ä¸ Mock ä»€ä¹ˆ |
| -------- | --------- | ------------ |
| å•å…ƒæµ‹è¯•ï¼ˆå·¥å…·ï¼‰ | æ— éœ€ Mock | è¢«æµ‹å‡½æ•°æœ¬èº« |
| å•å…ƒæµ‹è¯•ï¼ˆä»“åº“ï¼‰ | æ•°æ®åº“ â†’ Mock DB | è¢«æµ‹ä»“åº“é€»è¾‘ |
| å•å…ƒæµ‹è¯•ï¼ˆæœåŠ¡ï¼‰ | ä»“åº“å±‚ â†’ vi.mock() | è¢«æµ‹æœåŠ¡é€»è¾‘ |
| é›†æˆæµ‹è¯•ï¼ˆRPCï¼‰ | å¤–éƒ¨ä¾èµ– | Gateway + æœåŠ¡ + ä»“åº“ |
| E2E æµ‹è¯• | æ—  | å…¨æ ˆ |

## 1.2 æµ‹è¯•æ‰§è¡Œé¡ºåºè§„èŒƒ

æµ‹è¯•åˆ† **ä¸‰ä¸ªé˜¶æ®µ** ä¾æ¬¡æ‰§è¡Œï¼Œå‰ä¸€é˜¶æ®µé€šè¿‡åæ‰è¿›å…¥ä¸‹ä¸€é˜¶æ®µï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ é˜¶æ®µ A: åç«¯æ¥å£æµ‹è¯•ï¼ˆå•å…ƒ + é›†æˆï¼‰                       â”‚
â”‚   1. åŸºç¡€å·¥å…· â†’ å¯†ç ã€JWTã€ID                             â”‚
â”‚   2. æ•°æ®è®¿é—®å±‚ â†’ ä»“åº“ï¼ˆMock DBï¼‰                          â”‚
â”‚   3. ä¸šåŠ¡æœåŠ¡å±‚ â†’ è®¤è¯ã€è®¢é˜…ã€æŠ€èƒ½ï¼ˆMock ä»“åº“ï¼‰            â”‚
â”‚   4. Gateway RPC â†’ server-methodsï¼ˆé›†æˆï¼‰                 â”‚
â”‚   âœ… é€šè¿‡æ ‡å‡†ï¼šP0 æ¨¡å—æµ‹è¯•å…¨éƒ¨é€šè¿‡ï¼Œè¦†ç›–ç‡ â‰¥ 70%           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é˜¶æ®µ B: å‰åç«¯è”è°ƒæµ‹è¯•  ï¼ˆé¡µé¢å¯ä»¥ä½¿ç”¨playwright mcpå®Œæˆæµ‹è¯•ï¼‰                                  â”‚
â”‚   5. Gateway å®¢æˆ·ç«¯ â†’ è¿æ¥ã€RPC è°ƒç”¨                      â”‚
â”‚   6. å‰ç«¯é¡µé¢ â†’ ç™»å½•ã€åˆ—è¡¨ã€CRUD                          â”‚
â”‚   7. å‰åç«¯æ•°æ®æµ â†’ è¯·æ±‚ â†’ å“åº” â†’ æ¸²æŸ“                    â”‚
â”‚   âœ… é€šè¿‡æ ‡å‡†ï¼šæ ¸å¿ƒä¸šåŠ¡æµç¨‹å‰åç«¯æ‰“é€š                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é˜¶æ®µ C: E2E ä¸æ‰‹åŠ¨æµ‹è¯•                                    â”‚
â”‚   8. ç”¨æˆ·æ³¨å†Œâ†’ç™»å½•â†’å¯¹è¯â†’æŠ€èƒ½â†’æ”¯ä»˜ å®Œæ•´æµç¨‹                  â”‚
â”‚   9. Windows æ¡Œé¢ Phase 1ï½4 æ‰‹åŠ¨æµ‹è¯•                     â”‚
â”‚   âœ… é€šè¿‡æ ‡å‡†ï¼šæ ¸å¿ƒåœºæ™¯ç«¯åˆ°ç«¯é€šè¿‡                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ‰§è¡Œå‘½ä»¤**:

```bash
# é˜¶æ®µ Aï¼šåç«¯å•å…ƒæµ‹è¯•
pnpm test                          # è¿è¡Œå…¨éƒ¨
pnpm test src/db/utils/            # è¿è¡Œç‰¹å®šæ¨¡å—
pnpm test:coverage                 # å¸¦è¦†ç›–ç‡

# é˜¶æ®µ Bï¼šå‰ç«¯å¼€å‘æœåŠ¡å™¨ + è”è°ƒ
cd apps/admin-console && pnpm dev  # å¯åŠ¨ç®¡ç†åå°
cd apps/web-admin && pnpm dev      # å¯åŠ¨ç”¨æˆ· Web
cd apps/windows && pnpm dev        # å¯åŠ¨ Windows å®¢æˆ·ç«¯

# é˜¶æ®µ Cï¼šE2E
pnpm test:e2e                      # ç«¯åˆ°ç«¯æµ‹è¯•

ä½¿ç”¨æµ‹è¯•æŠ€èƒ½è¿›è¡Œæµ‹è¯•
```

## 1.3 æµ‹è¯•å®Œæˆåæ›´æ–°æµç¨‹

æµ‹è¯•å®Œæˆåï¼ŒæŒ‰ä»¥ä¸‹æ­¥éª¤æ›´æ–°æœ¬æ–‡æ¡£ï¼š

### æ­¥éª¤ 1ï¼šæ›´æ–°è¿›åº¦è¡¨

æ‰¾åˆ°ã€Œç¬¬ä¸ƒéƒ¨åˆ†ï¼šæµ‹è¯•è¿›åº¦è·Ÿè¸ªã€ï¼Œæ›´æ–°å¯¹åº”æ¨¡å—çš„ç”¨ä¾‹æ•°ã€é€šè¿‡æ•°ã€å¤±è´¥æ•°å’ŒçŠ¶æ€ã€‚

```markdown
| utils/password | password.test.ts | 12 | 12 | 0 | âœ… |
```

### æ­¥éª¤ 2ï¼šæ›´æ–°è¿›åº¦ç»Ÿè®¡

æ›´æ–°æ–‡æ¡£é¡¶éƒ¨çš„ã€Œæµ‹è¯•è¿›åº¦ç»Ÿè®¡ã€è¡¨ã€‚

### æ­¥éª¤ 3ï¼šè®°å½•é—®é¢˜

å¦‚æœ‰å¤±è´¥ç”¨ä¾‹ï¼Œåœ¨ã€Œç¬¬å…«éƒ¨åˆ†ï¼šé—®é¢˜è·Ÿè¸ªã€ä¸­è®°å½•ï¼š

```markdown
| 2 | auth-service | AUTH-LOGIN-006 é™æµé€»è¾‘è¾¹ç•Œæ¡ä»¶ | ğŸ”„ ä¿®å¤ä¸­ |
```

### æ­¥éª¤ 4ï¼šæ›´æ–°ä¿®è®¢è®°å½•

åœ¨ä¿®è®¢è®°å½•è¡¨ä¸­å¢åŠ ä¸€è¡Œï¼Œæ³¨æ˜æ—¥æœŸå’Œä¿®è®¢å†…å®¹ã€‚

### æ­¥éª¤ 5ï¼šæäº¤å˜æ›´

```bash
scripts/committer "test: æ›´æ–°æµ‹è¯•è¿›åº¦ - <æ¨¡å—å>" my-docs/æ–°å¢åŠŸèƒ½/06-æµ‹è¯•è®¡åˆ’ä¸ç”¨ä¾‹æ¸…å•ï¼ˆæ•´åˆç‰ˆï¼‰.md
```

---

# ç¬¬äºŒéƒ¨åˆ†ï¼šæµ‹è¯•æ¦‚è¿°ä¸ç­–ç•¥

## 2.1 æµ‹è¯•ç›®æ ‡

| ç›®æ ‡       | æè¿°                           |
| ---------- | ------------------------------ |
| åŠŸèƒ½æ­£ç¡®æ€§ | éªŒè¯æ‰€æœ‰ä¸šåŠ¡é€»è¾‘æŒ‰è®¾è®¡æ–‡æ¡£å®ç° |
| ä»£ç è¦†ç›–ç‡ | è¾¾åˆ° 70% ä»¥ä¸Šçš„è¡Œè¦†ç›–ç‡        |
| å›å½’ä¿æŠ¤   | é˜²æ­¢åç»­ä¿®æ”¹å¼•å…¥æ–° Bug         |
| è°ƒè¯•å‹å¥½   | é€šè¿‡è¯¦ç»†æ—¥å¿—å¿«é€Ÿå®šä½é—®é¢˜       |

## 2.2 æµ‹è¯•èŒƒå›´

| æ¨¡å—                                | æµ‹è¯•ç±»å‹ | ä¼˜å…ˆçº§ | çŠ¶æ€                   |
| ----------------------------------- | -------- | ------ | ---------------------- |
| å¯†ç å·¥å…· (utils/password)           | å•å…ƒæµ‹è¯• | P0     | âœ… å·²å®Œæˆ (12/12 é€šè¿‡)  |
| JWT å·¥å…· (auth/jwt)                 | å•å…ƒæµ‹è¯• | P0     | âœ… å·²å®Œæˆ (18/18 é€šè¿‡) |
| ç”¨æˆ·ä»“åº“ (repositories/users)       | å•å…ƒæµ‹è¯• | P0     | âœ… å·²å®Œæˆ (22/22 é€šè¿‡) |
| ç”¨æˆ·è®¤è¯æœåŠ¡ (auth-service)         | å•å…ƒæµ‹è¯• | P0     | âœ… å·²å®Œæˆ (21/21 é€šè¿‡) |
| ç®¡ç†å‘˜è®¤è¯æœåŠ¡ (admin-auth-service) | å•å…ƒæµ‹è¯• | P0     | âœ… å·²å®Œæˆ (20/20 é€šè¿‡) |
| è®¢é˜…æœåŠ¡ (subscription/service)     | å•å…ƒæµ‹è¯• | P0     | âœ… å·²å®Œæˆ (31/31 é€šè¿‡) |
| æŠ€èƒ½æœåŠ¡ (skill-service)            | å•å…ƒæµ‹è¯• | P0     | âœ… å·²å®Œæˆ (25/25 é€šè¿‡) |
| ID ç”Ÿæˆå·¥å…· (utils/id)              | å•å…ƒæµ‹è¯• | P1     | âœ… å·²å®Œæˆ (9/9 é€šè¿‡)   |
| Gateway RPC æ–¹æ³•                    | é›†æˆæµ‹è¯• | P1     | âœ… å·²å®Œæˆ (å•å…ƒ209é€šè¿‡, E2E 112/114, 2è·³è¿‡) |
| admin-console åŠŸèƒ½                  | å‰ç«¯æµ‹è¯• | P0     | âœ… å…¨éƒ¨é€šè¿‡ (39/39, P0+P1+P2) |
| web-admin åŠŸèƒ½                      | å‰ç«¯æµ‹è¯• | P0     | âœ… å·²å®Œæˆ (17/17 é€šè¿‡) |
| windows æ¡Œé¢åŠŸèƒ½                    | E2E/æ‰‹åŠ¨ | P0     | âœ… UIæµ‹è¯•å®Œæˆ (14/14 é€šè¿‡) |

## 2.3 æµ‹è¯•æ¡†æ¶

| å·¥å…·                 | ç”¨é€”           |
| -------------------- | -------------- |
| Vitest               | æµ‹è¯•è¿è¡Œå™¨     |
| V8 Coverage          | ä»£ç è¦†ç›–ç‡     |
| Mock Database        | å†…å­˜æ•°æ®åº“æ¨¡æ‹Ÿ |
| vi.fn() / vi.spyOn() | å‡½æ•° Mock      |

---

# ç¬¬ä¸‰éƒ¨åˆ†ï¼šæµ‹è¯•ç¯å¢ƒä¸ Mock ç­–ç•¥

## 3.1 ç¯å¢ƒå˜é‡

```bash
# .env.test
NODE_ENV=test
JWT_SECRET=test-jwt-secret-at-least-32-characters-long
DATABASE_URL=mock://localhost/test
LOG_LEVEL=debug
```

## 3.2 Mock æ•°æ®åº“

ä½¿ç”¨ `src/db/mock-connection.ts`ï¼š

```typescript
import {
  enableMockDatabase,
  disableMockDatabase,
  clearMockDatabase,
  seedMockTable,
  getMockDatabase,
} from "../../db/mock-connection.js";

// æ ‡å‡†ç”Ÿå‘½å‘¨æœŸ
beforeAll(() => enableMockDatabase());
afterAll(() => disableMockDatabase());
beforeEach(() => clearMockDatabase());
```

**é¢„ç½®ç§å­æ•°æ®ç¤ºä¾‹**ï¼š

```typescript
seedMockTable("users", [
  {
    id: "test-user-1",
    phone: "+8613800138000",
    email: "test@example.com",
    passwordHash: "$scrypt$...",
    isActive: true,
  },
]);
```

## 3.3 å¤–éƒ¨æœåŠ¡ Mock

```typescript
// éªŒè¯ç æœåŠ¡
vi.mock("../../services/sms-service.js", () => ({
  sendVerificationCode: vi.fn().mockResolvedValue({ success: true }),
}));

// æ”¯ä»˜æœåŠ¡
vi.mock("../../assistant/payment/service.js", () => ({
  createPayment: vi.fn().mockResolvedValue({ orderId: "mock-order-1" }),
}));
```

## 3.4 æ—¶é—´ Mock

```typescript
beforeEach(() => {
  vi.useFakeTimers();
  vi.setSystemTime(new Date("2026-02-10T10:00:00Z"));
});
afterEach(() => vi.useRealTimers());
```

## 3.5 æ—¥å¿—éªŒè¯

```typescript
const mockLogger = {
  debug: vi.fn(), info: vi.fn(), warn: vi.fn(), error: vi.fn(),
};

// éªŒè¯æ—¥å¿—è¾“å‡º
expect(mockLogger.info).toHaveBeenCalledWith(
  expect.stringContaining("[auth]"),
  expect.objectContaining({ userId: expect.any(String) }),
);
```

## 3.6 è¦†ç›–ç‡ç›®æ ‡

| æŒ‡æ ‡       | æ•´ä½“ç›®æ ‡ | æ ¸å¿ƒæ¨¡å—ï¼ˆauth/repoï¼‰ |
| ---------- | -------- | --------------------- |
| è¡Œè¦†ç›–ç‡   | â‰¥ 70%    | â‰¥ 80%                 |
| å‡½æ•°è¦†ç›–ç‡ | â‰¥ 70%    | â‰¥ 80%                 |
| åˆ†æ”¯è¦†ç›–ç‡ | â‰¥ 55%    | â‰¥ 65%                 |

---

# ç¬¬å››éƒ¨åˆ†ï¼šæµ‹è¯•æ‰§è¡Œé¡ºåº

```
é˜¶æ®µ 1: åŸºç¡€å·¥å…·æµ‹è¯• (æ— ä¾èµ–)
â”œâ”€â”€ utils/password.test.ts     â”€ å¯†ç å“ˆå¸Œ/éªŒè¯/å¼ºåº¦
â”œâ”€â”€ utils/id.test.ts           â”€ ID ç”Ÿæˆ
â””â”€â”€ auth/jwt.test.ts           â”€ JWT ç”Ÿæˆ/éªŒè¯/æå–

é˜¶æ®µ 2: æ•°æ®è®¿é—®å±‚æµ‹è¯• (ä¾èµ– Mock DB)
â”œâ”€â”€ repositories/users.test.ts         â”€ ç”¨æˆ· CRUD
â”œâ”€â”€ repositories/admins.test.ts        â”€ ç®¡ç†å‘˜ CRUD
â””â”€â”€ repositories/subscriptions.test.ts â”€ è®¢é˜… CRUD

é˜¶æ®µ 3: ä¸šåŠ¡æœåŠ¡å±‚æµ‹è¯• (Mock ä»“åº“)
â”œâ”€â”€ auth/auth-service.test.ts              â”€ ç”¨æˆ·è®¤è¯
â”œâ”€â”€ admin-auth/admin-auth-service.test.ts  â”€ ç®¡ç†å‘˜è®¤è¯
â”œâ”€â”€ subscription/service.test.ts           â”€ è®¢é˜…ç®¡ç†
â””â”€â”€ skills/skill-service.test.ts           â”€ æŠ€èƒ½ç®¡ç†

é˜¶æ®µ 4: Gateway RPC æµ‹è¯• (é›†æˆ)
â”œâ”€â”€ server-methods/admin-auth.test.ts
â”œâ”€â”€ server-methods/admin-users.test.ts
â””â”€â”€ server-methods/assistant-auth.test.ts

é˜¶æ®µ 5: å‰åç«¯è”è°ƒæµ‹è¯•
â”œâ”€â”€ admin-console: ç™»å½• â†’ ç”¨æˆ·ç®¡ç† â†’ è®¢é˜…ç®¡ç†
â”œâ”€â”€ web-admin: ç™»å½• â†’ è®¾å¤‡ â†’ æŠ€èƒ½å•†åº— â†’ è®¢é˜…
â””â”€â”€ windows: Gateway è¿æ¥ â†’ å¯¹è¯ â†’ æ–‡ä»¶ â†’ æŠ€èƒ½

é˜¶æ®µ 6: E2E æµ‹è¯•
â”œâ”€â”€ e2e/user-registration.e2e.test.ts
â”œâ”€â”€ e2e/admin-login.e2e.test.ts
â””â”€â”€ e2e/skill-store.e2e.test.ts
```

---

# ç¬¬äº”éƒ¨åˆ†ï¼šåç«¯è¯¦ç»†æµ‹è¯•ç”¨ä¾‹

## 5.1 å¯†ç å·¥å…· (src/db/utils/password.ts)

### hashPassword()

| ç”¨ä¾‹ID       | åœºæ™¯         | è¾“å…¥           | é¢„æœŸè¾“å‡º                     | æ—¥å¿— |
| ------------ | ------------ | -------------- | ---------------------------- | ---- |
| PWD-HASH-001 | æ­£å¸¸å¯†ç å“ˆå¸Œ | `"Test@123"`   | ä»¥ `$scrypt$` å¼€å¤´ï¼Œ7æ®µåˆ†éš”  | æ—    |
| PWD-HASH-002 | ç©ºå¯†ç        | `""`           | æ­£å¸¸è¿”å›å“ˆå¸Œå­—ç¬¦ä¸²           | æ—    |
| PWD-HASH-003 | é•¿å¯†ç        | 128 å­—ç¬¦å­—ç¬¦ä¸² | æ­£å¸¸è¿”å›å“ˆå¸Œå­—ç¬¦ä¸²           | æ—    |

### verifyPassword()

| ç”¨ä¾‹ID         | åœºæ™¯       | è¾“å…¥              | é¢„æœŸè¾“å‡º | æ—¥å¿— |
| -------------- | ---------- | ----------------- | -------- | ---- |
| PWD-VERIFY-001 | æ­£ç¡®å¯†ç    | å¯†ç  + åŒ¹é…å“ˆå¸Œ   | `true`   | æ—    |
| PWD-VERIFY-002 | é”™è¯¯å¯†ç    | é”™è¯¯å¯†ç  + å“ˆå¸Œ   | `false`  | æ—    |
| PWD-VERIFY-003 | æ— æ•ˆå“ˆå¸Œ   | å¯†ç  + éæ³•å“ˆå¸Œä¸² | `false`  | æ—    |
| PWD-VERIFY-004 | ç©ºå¯†ç éªŒè¯ | `""` + å“ˆå¸Œ        | `false`  | æ—    |

### validatePasswordStrength()

| ç”¨ä¾‹ID        | åœºæ™¯         | è¾“å…¥         | é¢„æœŸè¾“å‡º                                           | æ—¥å¿— |
| ------------- | ------------ | ------------ | -------------------------------------------------- | ---- |
| PWD-VALID-001 | å¼ºå¯†ç        | `"Test@123"` | `{ valid: true, errors: [] }`                      | æ—    |
| PWD-VALID-002 | å¤ªçŸ­ (<8)    | `"Test@1"`   | `{ valid: false, errors: ["å¯†ç é•¿åº¦è‡³å°‘ 8 ä½"] }`  | æ—    |
| PWD-VALID-003 | ç¼ºå°‘å°å†™     | `"TEST@123"` | `{ valid: false, errors: ["å¯†ç éœ€åŒ…å«å°å†™å­—æ¯"] }` | æ—    |
| PWD-VALID-004 | ç¼ºå°‘å¤§å†™     | `"test@123"` | `{ valid: false, errors: ["å¯†ç éœ€åŒ…å«å¤§å†™å­—æ¯"] }` | æ—    |
| PWD-VALID-005 | ç¼ºå°‘æ•°å­—     | `"Test@abc"` | `{ valid: false, errors: ["å¯†ç éœ€åŒ…å«æ•°å­—"] }`     | æ—    |

**ä»£ç ç¤ºä¾‹**ï¼š

```typescript
import { describe, it, expect } from "vitest";
import { hashPassword, verifyPassword, validatePasswordStrength } from "./password.js";

describe("hashPassword", () => {
  it("PWD-HASH-001: åº”è¯¥æ­£ç¡®å“ˆå¸Œæ­£å¸¸å¯†ç ", async () => {
    const hash = await hashPassword("Test@123");
    expect(hash).toMatch(/^\$scrypt\$/);
    expect(hash.split("$")).toHaveLength(7);
  });
});

describe("verifyPassword", () => {
  it("PWD-VERIFY-001: åº”è¯¥éªŒè¯æ­£ç¡®å¯†ç ", async () => {
    const hash = await hashPassword("Test@123");
    expect(await verifyPassword("Test@123", hash)).toBe(true);
  });

  it("PWD-VERIFY-002: åº”è¯¥æ‹’ç»é”™è¯¯å¯†ç ", async () => {
    const hash = await hashPassword("Test@123");
    expect(await verifyPassword("Wrong@123", hash)).toBe(false);
  });
});

describe("validatePasswordStrength", () => {
  it("PWD-VALID-001: åº”è¯¥é€šè¿‡å¼ºå¯†ç ", () => {
    const result = validatePasswordStrength("Test@123");
    expect(result.valid).toBe(true);
    expect(result.errors).toHaveLength(0);
  });

  it("PWD-VALID-002: åº”è¯¥æ‹’ç»å¤ªçŸ­å¯†ç ", () => {
    const result = validatePasswordStrength("Test@1");
    expect(result.valid).toBe(false);
    expect(result.errors).toContain("å¯†ç é•¿åº¦è‡³å°‘ 8 ä½");
  });
});
```

---

## 5.2 JWT å·¥å…· (src/assistant/auth/jwt.ts)

### generateAccessToken()

| ç”¨ä¾‹ID      | åœºæ™¯            | è¾“å…¥                         | é¢„æœŸè¾“å‡º                                   | æ—¥å¿—                           |
| ----------- | --------------- | ---------------------------- | ------------------------------------------ | ------------------------------ |
| JWT-GEN-001 | ç”Ÿæˆç”¨æˆ· Token  | `userId: "test-user-1"`      | `{ accessToken: string, expiresIn: 900 }`  | `[jwt] Access token generated` |
| JWT-GEN-002 | è‡ªå®šä¹‰è¿‡æœŸæ—¶é—´  | `userId, expiresIn: "1h"`    | `{ accessToken: string, expiresIn: 3600 }` | `[jwt] Access token generated` |
| JWT-GEN-003 | ç¼ºå°‘ JWT_SECRET | æœªè®¾ç½® `JWT_SECRET` ç¯å¢ƒå˜é‡ | æŠ›å‡ºé”™è¯¯                                   | æ—                              |

### verifyAccessToken()

| ç”¨ä¾‹ID         | åœºæ™¯             | è¾“å…¥            | é¢„æœŸè¾“å‡º                 | æ—¥å¿—                       |
| -------------- | ---------------- | --------------- | ------------------------ | -------------------------- |
| JWT-VERIFY-001 | éªŒè¯æœ‰æ•ˆ Token   | æœ‰æ•ˆ Token      | `UserAccessTokenPayload` | æ—                          |
| JWT-VERIFY-002 | éªŒè¯è¿‡æœŸ Token   | è¿‡æœŸ Token      | `null`                   | `[jwt] Token expired`      |
| JWT-VERIFY-003 | éªŒè¯æ— æ•ˆ Token   | `"invalid"`     | `null`                   | `[jwt] Invalid token`      |
| JWT-VERIFY-004 | ç±»å‹ä¸åŒ¹é… Token | Device Token    | `null`                   | `[jwt] Invalid token type` |
| JWT-VERIFY-005 | ç¯¡æ”¹ Token       | ä¿®æ”¹ payload å | `null`                   | `[jwt] Invalid token`      |

### extractBearerToken()

| ç”¨ä¾‹ID          | åœºæ™¯              | è¾“å…¥              | é¢„æœŸè¾“å‡º   | æ—¥å¿— |
| --------------- | ----------------- | ----------------- | ---------- | ---- |
| JWT-EXTRACT-001 | æ­£å¸¸ Bearer Token | `"Bearer abc123"` | `"abc123"` | æ—    |
| JWT-EXTRACT-002 | æ—  Bearer å‰ç¼€    | `"abc123"`        | `null`     | æ—    |
| JWT-EXTRACT-003 | ç©º Header         | `undefined`       | `null`     | æ—    |

**ä»£ç ç¤ºä¾‹**ï¼š

```typescript
import { describe, it, expect, beforeAll } from "vitest";
import { generateAccessToken, verifyAccessToken, extractBearerToken } from "./jwt.js";

describe("generateAccessToken", () => {
  beforeAll(() => {
    process.env.JWT_SECRET = "test-jwt-secret-at-least-32-characters-long";
  });

  it("JWT-GEN-001: åº”è¯¥ç”Ÿæˆæœ‰æ•ˆçš„ Access Token", () => {
    const result = generateAccessToken("test-user-1");
    expect(result.accessToken).toBeTruthy();
    expect(result.expiresIn).toBe(900);

    const payload = verifyAccessToken(result.accessToken);
    expect(payload?.sub).toBe("test-user-1");
    expect(payload?.type).toBe("user");
  });
});

describe("verifyAccessToken", () => {
  it("JWT-VERIFY-002: åº”è¯¥æ‹’ç»è¿‡æœŸ Token", () => {
    vi.useFakeTimers();
    const { accessToken } = generateAccessToken("test-user-1");
    vi.advanceTimersByTime(16 * 60 * 1000); // 16åˆ†é’Ÿåè¿‡æœŸ
    expect(verifyAccessToken(accessToken)).toBeNull();
    vi.useRealTimers();
  });
});

describe("extractBearerToken", () => {
  it("JWT-EXTRACT-001: åº”è¯¥æå– Bearer Token", () => {
    expect(extractBearerToken("Bearer abc123")).toBe("abc123");
  });
  it("JWT-EXTRACT-002: æ— å‰ç¼€åº”è¿”å› null", () => {
    expect(extractBearerToken("abc123")).toBeNull();
  });
});
```

---

## 5.3 ç”¨æˆ·ä»“åº“ (src/db/repositories/users.ts)

### UserRepository.create()

| ç”¨ä¾‹ID          | åœºæ™¯           | è¾“å…¥                                                 | é¢„æœŸè¾“å‡º              | æ—¥å¿—                       |
| --------------- | -------------- | ---------------------------------------------------- | --------------------- | -------------------------- |
| USER-CREATE-001 | åˆ›å»ºæ‰‹æœºå·ç”¨æˆ· | `{ phone: "+8613800138000", passwordHash: "..." }`   | è¿”å›ç”¨æˆ·ï¼Œid è‡ªåŠ¨ç”Ÿæˆ | `[user-repo] User created` |
| USER-CREATE-002 | åˆ›å»ºé‚®ç®±ç”¨æˆ·   | `{ email: "test@example.com", passwordHash: "..." }` | è¿”å›ç”¨æˆ·              | `[user-repo] User created` |
| USER-CREATE-003 | è‡ªåŠ¨å“ˆå¸Œå¯†ç    | `{ phone: "...", passwordHash: "plaintext" }`        | passwordHash ä»¥ `$scrypt$` å¼€å¤´ | `[user-repo] User created` |
| USER-CREATE-004 | åˆ›å»ºå¾®ä¿¡ç”¨æˆ·   | `{ wechatOpenId: "wx123", displayName: "..." }`      | è¿”å›ç”¨æˆ·              | `[user-repo] User created` |

### UserRepository.findByIdentifier()

| ç”¨ä¾‹ID        | åœºæ™¯           | è¾“å…¥                     | é¢„æœŸè¾“å‡º     | æ—¥å¿— |
| ------------- | -------------- | ------------------------ | ------------ | ---- |
| USER-FIND-001 | é€šè¿‡æ‰‹æœºå·æŸ¥æ‰¾ | `"+8613800138000"`       | è¿”å›ç”¨æˆ·å¯¹è±¡ | æ—    |
| USER-FIND-002 | é€šè¿‡é‚®ç®±æŸ¥æ‰¾   | `"test@example.com"`     | è¿”å›ç”¨æˆ·å¯¹è±¡ | æ—    |
| USER-FIND-003 | ç”¨æˆ·ä¸å­˜åœ¨     | `"nonexist@example.com"` | `null`       | æ—    |

### UserSessionRepository.create()

| ç”¨ä¾‹ID             | åœºæ™¯           | è¾“å…¥                               | é¢„æœŸè¾“å‡º                    | æ—¥å¿—                                  |
| ------------------ | -------------- | ---------------------------------- | --------------------------- | ------------------------------------- |
| SESSION-CREATE-001 | åˆ›å»ºä¼šè¯       | `userId, { ipAddress, userAgent }` | `{ session, refreshToken }` | `[user-session-repo] Session created` |
| SESSION-CREATE-002 | è‡ªå®šä¹‰è¿‡æœŸæ—¶é—´ | `userId, { expiresInMs: 3600000 }` | 1 å°æ—¶åè¿‡æœŸ                | `[user-session-repo] Session created` |
| SESSION-CREATE-003 | é»˜è®¤è¿‡æœŸæ—¶é—´   | `userId, {}`                       | 7 å¤©åè¿‡æœŸ                  | `[user-session-repo] Session created` |

### VerificationCodeRepository.verify()

| ç”¨ä¾‹ID          | åœºæ™¯           | è¾“å…¥                           | é¢„æœŸè¾“å‡º | æ—¥å¿—                                     |
| --------------- | -------------- | ------------------------------ | -------- | ---------------------------------------- |
| CODE-VERIFY-001 | éªŒè¯æ­£ç¡®éªŒè¯ç  | `target, code, purpose`        | `true`   | `[verification-code-repo] Code verified` |
| CODE-VERIFY-002 | éªŒè¯é”™è¯¯éªŒè¯ç  | `target, wrongCode, purpose`   | `false`  | æ—                                        |
| CODE-VERIFY-003 | éªŒè¯è¿‡æœŸéªŒè¯ç  | `target, expiredCode, purpose` | `false`  | æ—                                        |
| CODE-VERIFY-004 | å·²ä½¿ç”¨çš„éªŒè¯ç  | `target, usedCode, purpose`    | `false`  | æ—                                        |

**ä»£ç ç¤ºä¾‹**ï¼š

```typescript
import { describe, it, expect, beforeEach } from "vitest";
import { enableMockDatabase, clearMockDatabase, getMockDatabase } from "../../db/mock-connection.js";
import { UserRepository } from "./users.js";

describe("UserRepository", () => {
  let userRepo: UserRepository;

  beforeEach(() => {
    enableMockDatabase();
    clearMockDatabase();
    userRepo = new UserRepository(getMockDatabase());
  });

  it("USER-CREATE-001: åº”è¯¥åˆ›å»ºæ‰‹æœºå·ç”¨æˆ·", async () => {
    const user = await userRepo.create({
      phone: "+8613800138000",
      passwordHash: "Test@123",
      displayName: "æµ‹è¯•ç”¨æˆ·",
    });
    expect(user.id).toBeTruthy();
    expect(user.phone).toBe("+8613800138000");
    expect(user.isActive).toBe(true);
  });

  it("USER-FIND-003: ç”¨æˆ·ä¸å­˜åœ¨åº”è¿”å› null", async () => {
    const user = await userRepo.findByIdentifier("nonexist@example.com");
    expect(user).toBeNull();
  });
});
```

---

## 5.4 ç”¨æˆ·è®¤è¯æœåŠ¡ (src/assistant/auth/auth-service.ts)

### register()

| ç”¨ä¾‹ID       | åœºæ™¯           | è¾“å…¥                                | é¢„æœŸè¾“å‡º                                                | æ—¥å¿—                                              |
| ------------ | -------------- | ----------------------------------- | ------------------------------------------------------- | ------------------------------------------------- |
| AUTH-REG-001 | æ‰‹æœºå·æ³¨å†ŒæˆåŠŸ | `{ phone, code, password }`         | `{ success: true, user, accessToken, refreshToken }`    | `[auth] User registered successfully`             |
| AUTH-REG-002 | é‚®ç®±æ³¨å†ŒæˆåŠŸ   | `{ email, code, password }`         | `{ success: true, user, accessToken }`                  | `[auth] User registered successfully`             |
| AUTH-REG-003 | ç¼ºå°‘æ ‡è¯†ç¬¦     | `{ code, password }`                | `{ success: false, errorCode: "MISSING_IDENTIFIER" }`   | æ—                                                 |
| AUTH-REG-004 | ç”¨æˆ·å·²å­˜åœ¨     | å·²æ³¨å†Œçš„ phone                      | `{ success: false, errorCode: "USER_EXISTS" }`          | `[auth] Registration failed: user already exists` |
| AUTH-REG-005 | éªŒè¯ç é”™è¯¯     | `{ phone, wrongCode, password }`    | `{ success: false, errorCode: "INVALID_CODE" }`         | `[auth] Registration failed: invalid code`        |
| AUTH-REG-006 | å¼±å¯†ç          | `{ phone, code, password: "123" }`  | `{ success: false, errorCode: "WEAK_PASSWORD" }`        | æ—                                                 |

### login()

| ç”¨ä¾‹ID         | åœºæ™¯           | è¾“å…¥                            | é¢„æœŸè¾“å‡º                                                 | æ—¥å¿—                                           |
| -------------- | -------------- | ------------------------------- | -------------------------------------------------------- | ---------------------------------------------- |
| AUTH-LOGIN-001 | å¯†ç ç™»å½•æˆåŠŸ   | `{ identifier, password }`      | `{ success: true, user, accessToken, refreshToken }`     | `[auth] User logged in successfully`           |
| AUTH-LOGIN-002 | éªŒè¯ç ç™»å½•æˆåŠŸ | `{ identifier, code }`          | `{ success: true, user, accessToken }`                   | `[auth] User logged in successfully`           |
| AUTH-LOGIN-003 | ç”¨æˆ·ä¸å­˜åœ¨     | ä¸å­˜åœ¨çš„ identifier             | `{ success: false, errorCode: "INVALID_CREDENTIALS" }`   | `[auth] Login failed: user not found`          |
| AUTH-LOGIN-004 | å¯†ç é”™è¯¯       | `{ identifier, wrongPassword }` | `{ success: false, errorCode: "INVALID_CREDENTIALS" }`   | `[auth] Login failed: invalid credentials`     |
| AUTH-LOGIN-005 | è´¦æˆ·è¢«åœç”¨     | åœç”¨ç”¨æˆ·çš„ identifier           | `{ success: false, errorCode: "ACCOUNT_DISABLED" }`      | æ—                                              |
| AUTH-LOGIN-006 | IP é™æµ        | è¶…è¿‡ 20 æ¬¡å¤±è´¥                  | `{ success: false, errorCode: "IP_RATE_LIMITED" }`       | `[auth] Login blocked: IP rate limit exceeded` |
| AUTH-LOGIN-007 | è´¦æˆ·é”å®š       | è¶…è¿‡ 5 æ¬¡å¤±è´¥                   | `{ success: false, errorCode: "ACCOUNT_LOCKED" }`        | `[auth] Login blocked: account locked`         |
| AUTH-LOGIN-008 | ç¼ºå°‘å‡­æ®       | `{ identifier }`ï¼ˆæ— å¯†ç æ— éªŒè¯ç ï¼‰| `{ success: false, errorCode: "MISSING_CREDENTIALS" }` | æ—                                              |

### refreshToken()

| ç”¨ä¾‹ID           | åœºæ™¯         | è¾“å…¥                 | é¢„æœŸè¾“å‡º                                                   | æ—¥å¿—                                                      |
| ---------------- | ------------ | -------------------- | ---------------------------------------------------------- | --------------------------------------------------------- |
| AUTH-REFRESH-001 | åˆ·æ–°æˆåŠŸ     | æœ‰æ•ˆ refreshToken    | `{ success: true, accessToken }`                           | `[auth] Token refreshed successfully`                     |
| AUTH-REFRESH-002 | æ— æ•ˆ Token   | æ— æ•ˆ refreshToken    | `{ success: false, errorCode: "INVALID_REFRESH_TOKEN" }`   | `[auth] Token refresh failed: invalid refresh token`      |
| AUTH-REFRESH-003 | ç”¨æˆ·å·²åˆ é™¤   | å·²åˆ é™¤ç”¨æˆ·çš„ Token   | `{ success: false, errorCode: "USER_INACTIVE" }`           | `[auth] Token refresh failed: user not found or inactive` |
| AUTH-REFRESH-004 | Token è½®è½¬   | å³å°†è¿‡æœŸçš„ Token     | è¿”å›æ–°çš„ refreshToken                                      | `[auth] Refresh token rotated`                            |

### logout()

| ç”¨ä¾‹ID          | åœºæ™¯       | è¾“å…¥              | é¢„æœŸè¾“å‡º            | æ—¥å¿—                     |
| --------------- | ---------- | ----------------- | ------------------- | ------------------------ |
| AUTH-LOGOUT-001 | ç™»å‡ºæˆåŠŸ   | æœ‰æ•ˆ refreshToken | `{ success: true }` | `[auth] User logged out` |
| AUTH-LOGOUT-002 | Token ä¸å­˜åœ¨ | ä¸å­˜åœ¨çš„ Token  | `{ success: true }` | æ—                        |

**ä»£ç ç¤ºä¾‹**ï¼š

```typescript
import { describe, it, expect, beforeEach, vi } from "vitest";
import { enableMockDatabase, clearMockDatabase, seedMockTable } from "../../db/mock-connection.js";
import { register, login, refreshToken, logout } from "./auth-service.js";

describe("auth-service: register", () => {
  beforeEach(() => {
    enableMockDatabase();
    clearMockDatabase();
    process.env.JWT_SECRET = "test-jwt-secret-at-least-32-characters-long";
    seedMockTable("verification_codes", [{
      id: "code-1", target: "+8613800138000", targetType: "phone",
      code: "123456", purpose: "register",
      expiresAt: new Date(Date.now() + 5 * 60 * 1000), used: false, attempts: "0",
    }]);
  });

  it("AUTH-REG-001: åº”è¯¥æˆåŠŸæ³¨å†Œæ‰‹æœºå·ç”¨æˆ·", async () => {
    const result = await register({
      phone: "+8613800138000", code: "123456",
      password: "Test@123", displayName: "æµ‹è¯•ç”¨æˆ·",
    });
    expect(result.success).toBe(true);
    expect(result.user?.phone).toBe("+8613800138000");
    expect(result.accessToken).toBeTruthy();
  });

  it("AUTH-REG-006: å¼±å¯†ç åº”è¢«æ‹’ç»", async () => {
    const result = await register({
      phone: "+8613800138000", code: "123456", password: "123",
    });
    expect(result.success).toBe(false);
    expect(result.errorCode).toBe("WEAK_PASSWORD");
  });
});
```

---

## 5.5 ç®¡ç†å‘˜è®¤è¯æœåŠ¡ (src/assistant/admin-auth/admin-auth-service.ts)

### adminLogin()

| ç”¨ä¾‹ID          | åœºæ™¯         | è¾“å…¥                          | é¢„æœŸè¾“å‡º                                                 | æ—¥å¿—                                                          |
| --------------- | ------------ | ----------------------------- | -------------------------------------------------------- | ------------------------------------------------------------- |
| ADMIN-LOGIN-001 | ç™»å½•æˆåŠŸ     | `{ username, password }`      | `{ success: true, admin, accessToken }`                  | `[admin-auth] Admin logged in successfully`                   |
| ADMIN-LOGIN-002 | ç”¨æˆ·åä¸å­˜åœ¨ | ä¸å­˜åœ¨çš„ username             | `{ success: false, errorCode: "INVALID_CREDENTIALS" }`   | `[admin-auth] Login failed: admin not found`                  |
| ADMIN-LOGIN-003 | å¯†ç é”™è¯¯     | `{ username, wrongPassword }` | `{ success: false, errorCode: "INVALID_CREDENTIALS" }`   | `[admin-auth] Login failed: invalid password`                 |
| ADMIN-LOGIN-004 | è´¦æˆ·è¢«åœç”¨   | suspended çŠ¶æ€è´¦æˆ·            | `{ success: false, errorCode: "ACCOUNT_SUSPENDED" }`     | æ—                                                             |
| ADMIN-LOGIN-005 | è´¦æˆ·è¢«é”å®š   | locked çŠ¶æ€è´¦æˆ·               | `{ success: false, errorCode: "ACCOUNT_LOCKED" }`        | æ—                                                             |
| ADMIN-LOGIN-006 | IP é™æµ      | è¶…è¿‡ 20 æ¬¡å¤±è´¥                | `{ success: false, errorCode: "IP_RATE_LIMITED" }`       | `[admin-auth] Login blocked: IP rate limit exceeded`          |
| ADMIN-LOGIN-007 | è´¦æˆ·çº§é™æµ   | è¶…è¿‡ 5 æ¬¡å¤±è´¥                 | `{ success: false, errorCode: "ACCOUNT_LOCKED" }`        | `[admin-auth] Account locked due to too many failed attempts` |
| ADMIN-LOGIN-008 | MFA éªŒè¯     | å¯ç”¨ MFA çš„è´¦æˆ·               | `{ success: false, mfaRequired: true }`                  | æ—                                                             |

---

## 5.6 è®¢é˜…æœåŠ¡ (src/assistant/subscription/service.ts)

### getUserSubscription()

| ç”¨ä¾‹ID      | åœºæ™¯         | è¾“å…¥              | é¢„æœŸè¾“å‡º     | æ—¥å¿— |
| ----------- | ------------ | ----------------- | ------------ | ---- |
| SUB-GET-001 | è·å–æœ‰æ•ˆè®¢é˜… | userId            | è¿”å›è®¢é˜…å¯¹è±¡ | æ—    |
| SUB-GET-002 | ç”¨æˆ·æ— è®¢é˜…   | æ–°ç”¨æˆ· userId     | `null`       | æ—    |
| SUB-GET-003 | è®¢é˜…å·²è¿‡æœŸ   | è¿‡æœŸè®¢é˜…çš„ userId | è¿”å›è¿‡æœŸè®¢é˜…ï¼Œstatus = "expired" | æ—  |

### createSubscription()

| ç”¨ä¾‹ID         | åœºæ™¯         | è¾“å…¥                                | é¢„æœŸè¾“å‡º              | æ—¥å¿—       |
| -------------- | ------------ | ----------------------------------- | --------------------- | ---------- |
| SUB-CREATE-001 | åˆ›å»ºè®¢é˜…æˆåŠŸ | `{ userId, planId, billingPeriod }` | è¿”å›è®¢é˜…å¯¹è±¡          | `åˆ›å»ºè®¢é˜…` |
| SUB-CREATE-002 | ç”¨æˆ·å·²æœ‰è®¢é˜… | å·²è®¢é˜…ç”¨æˆ·                          | æŠ›å‡ºé”™è¯¯              | æ—          |
| SUB-CREATE-003 | è¯•ç”¨è®¢é˜…     | `{ startTrial: true }`              | status = `"trialing"` | `åˆ›å»ºè®¢é˜…` |
| SUB-CREATE-004 | ç»ˆèº«è®¢é˜…     | `{ billingPeriod: "lifetime" }`     | 100 å¹´åè¿‡æœŸ          | `åˆ›å»ºè®¢é˜…` |

### checkQuota()

| ç”¨ä¾‹ID          | åœºæ™¯         | è¾“å…¥                      | é¢„æœŸè¾“å‡º                              | æ—¥å¿—                     |
| --------------- | ------------ | ------------------------- | ------------------------------------- | ------------------------ |
| QUOTA-CHECK-001 | é…é¢å……è¶³     | `userId, "conversations"` | `{ allowed: true, remaining: N }`     | æ—                        |
| QUOTA-CHECK-002 | é…é¢è€—å°½     | å·²è¾¾ä¸Šé™çš„ userId         | `{ allowed: false, reason: "..." }`   | è®°å½• quota.exceeded äº‹ä»¶ |
| QUOTA-CHECK-003 | æ— é™é…é¢     | pro ç”¨æˆ·                  | `{ allowed: true, remaining: -1 }`    | æ—                        |
| QUOTA-CHECK-004 | æ¯æ—¥é…é¢é‡ç½® | è·¨å¤©æŸ¥è¯¢                  | remaining é‡ç½®ä¸ºè®¡åˆ’ä¸Šé™              | æ—                        |
| QUOTA-CHECK-005 | æ¯æœˆé…é¢é‡ç½® | è·¨æœˆæŸ¥è¯¢                  | remaining é‡ç½®ä¸ºè®¡åˆ’ä¸Šé™              | æ—                        |

---

## 5.7 æŠ€èƒ½æœåŠ¡ (src/assistant/skills/skill-service.ts)

### getSkillList()

| ç”¨ä¾‹ID         | åœºæ™¯         | è¾“å…¥                        | é¢„æœŸè¾“å‡º               | æ—¥å¿—                          |
| -------------- | ------------ | --------------------------- | ---------------------- | ----------------------------- |
| SKILL-LIST-001 | è·å–å…¨éƒ¨æŠ€èƒ½ | `{}`                        | è¿”å›åˆ†é¡µåˆ—è¡¨           | `[SkillService] getSkillList` |
| SKILL-LIST-002 | æœç´¢æŠ€èƒ½     | `{ search: "æ–‡ä»¶" }`        | è¿”å›åŒ¹é…ç»“æœ           | `[SkillService] getSkillList` |
| SKILL-LIST-003 | æŒ‰åˆ†ç±»ç­›é€‰   | `{ categoryId: "cat-1" }`   | åªè¿”å›è¯¥åˆ†ç±»æŠ€èƒ½       | `[SkillService] getSkillList` |
| SKILL-LIST-004 | æŒ‰çŠ¶æ€ç­›é€‰   | `{ status: "published" }`   | åªè¿”å›å·²å‘å¸ƒæŠ€èƒ½       | `[SkillService] getSkillList` |
| SKILL-LIST-005 | åˆ†é¡µæŸ¥è¯¢     | `{ page: 2, pageSize: 10 }` | è¿”å›ç¬¬ 2 é¡µï¼Œåç§»æ­£ç¡®  | `[SkillService] getSkillList` |

### createSkill()

| ç”¨ä¾‹ID           | åœºæ™¯         | è¾“å…¥            | é¢„æœŸè¾“å‡º             | æ—¥å¿—                         |
| ---------------- | ------------ | --------------- | -------------------- | ---------------------------- |
| SKILL-CREATE-001 | åˆ›å»ºæŠ€èƒ½æˆåŠŸ | å®Œæ•´æŠ€èƒ½æ•°æ®    | è¿”å›æŠ€èƒ½å¯¹è±¡         | `[SkillService] createSkill` |
| SKILL-CREATE-002 | è‡ªåŠ¨ç”Ÿæˆ ID  | ä¸æä¾› id       | è‡ªåŠ¨ç”Ÿæˆ UUID        | `[SkillService] createSkill` |
| SKILL-CREATE-003 | æ›´æ–°åˆ†ç±»è®¡æ•° | æŒ‡å®š categoryId | åˆ†ç±» skillCount + 1  | `[SkillService] createSkill` |

---

# ç¬¬å…­éƒ¨åˆ†ï¼šåº”ç”¨åŠŸèƒ½æµ‹è¯•æ¸…å•

> **æµ‹è¯•å·¥å…·**: Playwright + æœ¬åœ° Edge æµè§ˆå™¨ï¼ˆheadless: falseï¼‰ï¼Œè¿æ¥çœŸå® Gatewayï¼ˆdev æ¨¡å¼ç«¯å£ 19001ï¼‰å’Œ PostgreSQL æ•°æ®åº“
>
> **æµ‹è¯•è„šæœ¬ä½ç½®**: `test-browser/`
> - `admin-console-auth.mjs` â€” AC-AUTH-001~005
> - `admin-console-users.mjs` â€” AC-USER-001~005
> - `admin-console-sub-gw.mjs` â€” AC-SUB-001~003, AC-GW-001~005
> - `web-admin-all.mjs` â€” WA-AUTH~WA-GW å…¨é‡ 17 ä¸ªç”¨ä¾‹
>
> **æµ‹è¯•ç»“æœ JSON**: `test-browser/screenshots/` ç›®å½•ä¸‹å„ `*-test-results.json`
>
> **æˆªå›¾**: `test-browser/screenshots/` ç›®å½•ä¸‹å„ `*.png`

## 6.1 apps/admin-consoleï¼ˆç®¡ç†åå°ï¼‰

### 6.1.1 è®¤è¯ä¸æƒé™

| ç”¨ä¾‹ID       | åœºæ™¯             | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | ---------------- | -------- | -------- | ------ | ---- |
| AC-AUTH-001  | ç®¡ç†å‘˜ç™»å½•æˆåŠŸ   | è¾“å…¥æ­£ç¡®ç”¨æˆ·åå¯†ç  â†’ ç‚¹å‡»ç™»å½• | è·³è½¬åˆ°ä»ªè¡¨ç›˜ï¼ŒToken å­˜å‚¨åˆ° localStorage | P0 | âœ… |
| AC-AUTH-002  | ç™»å½•å¤±è´¥æç¤º     | è¾“å…¥é”™è¯¯å¯†ç  â†’ ç‚¹å‡»ç™»å½• | æ˜¾ç¤ºé”™è¯¯æç¤ºï¼Œä¸è·³è½¬ | P0 | âœ… |
| AC-AUTH-003  | æœªç™»å½•è·³è½¬       | ç›´æ¥è®¿é—® /users | è·³è½¬åˆ°ç™»å½•é¡µ | P0 | âœ… |
| AC-AUTH-004  | ç™»å‡º             | ç‚¹å‡»ç™»å‡ºæŒ‰é’® | æ¸…é™¤ Tokenï¼Œè·³è½¬ç™»å½•é¡µ | P0 | âœ… |
| AC-AUTH-005  | Token è¿‡æœŸè‡ªåŠ¨è·³è½¬ | Token è¿‡æœŸåæ“ä½œ | è·³è½¬ç™»å½•é¡µå¹¶æç¤º | P1 | âœ… å·²å®ç° JWT è§£ç ä¸è¿‡æœŸæ£€æŸ¥ |

### 6.1.2 ä»ªè¡¨ç›˜

| ç”¨ä¾‹ID       | åœºæ™¯           | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | -------------- | -------- | -------- | ------ | ---- |
| AC-DASH-001  | æ•°æ®åŠ è½½       | ç™»å½•åæŸ¥çœ‹ä»ªè¡¨ç›˜ | ç»Ÿè®¡å¡ç‰‡æ˜¾ç¤ºç”¨æˆ·æ•°ã€è®¢é˜…æ•°ç­‰ | P1 | âœ… |
| AC-DASH-002  | å›¾è¡¨æ¸²æŸ“       | æŸ¥çœ‹è¶‹åŠ¿å›¾ | å›¾è¡¨æ­£ç¡®æ¸²æŸ“ï¼Œæ— æŠ¥é”™ | P1 | âœ… |

### 6.1.3 ç”¨æˆ·ç®¡ç†

| ç”¨ä¾‹ID       | åœºæ™¯           | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | -------------- | -------- | -------- | ------ | ---- |
| AC-USER-001  | ç”¨æˆ·åˆ—è¡¨       | è¿›å…¥ç”¨æˆ·ç®¡ç† | åˆ†é¡µæ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨ | P0 | âœ… |
| AC-USER-002  | æœç´¢ç”¨æˆ·       | è¾“å…¥æ‰‹æœºå·/é‚®ç®±æœç´¢ | æ˜¾ç¤ºåŒ¹é…ç”¨æˆ· | P0 | âœ… |
| AC-USER-003  | ç”¨æˆ·è¯¦æƒ…       | ç‚¹å‡»ç”¨æˆ·è¡Œ | æ˜¾ç¤ºç”¨æˆ·å®Œæ•´ä¿¡æ¯ | P0 | âœ… ç©ºçŠ¶æ€æ­£å¸¸ |
| AC-USER-004  | ç¼–è¾‘ç”¨æˆ·       | ä¿®æ”¹ç”¨æˆ·çŠ¶æ€ â†’ ä¿å­˜ | çŠ¶æ€æ›´æ–°æˆåŠŸ | P0 | â³ æ— æ•°æ®å¯ç¼–è¾‘ |
| AC-USER-005  | åˆ†é¡µç¿»é¡µ       | ç‚¹å‡»ä¸‹ä¸€é¡µ | æ­£ç¡®åŠ è½½ä¸‹ä¸€é¡µæ•°æ® | P1 | âœ… ä¾§è¾¹æ å¯¼èˆª 5/5 |

### 6.1.4 è®¢é˜…ç®¡ç†

| ç”¨ä¾‹ID       | åœºæ™¯           | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | -------------- | -------- | -------- | ------ | ---- |
| AC-SUB-001   | è®¢é˜…åˆ—è¡¨       | è¿›å…¥è®¢é˜…ç®¡ç† | æ˜¾ç¤ºè®¢é˜…åˆ—è¡¨ | P0 | âœ… |
| AC-SUB-002   | æŸ¥çœ‹è®¡åˆ’       | è¿›å…¥è®¡åˆ’ç®¡ç† | æ˜¾ç¤ºæ‰€æœ‰è®¢é˜…è®¡åˆ’åŠå®šä»· | P0 | âœ… |
| AC-SUB-003   | æŸ¥çœ‹è®¢å•       | è¿›å…¥è®¢å•ç®¡ç† | æ˜¾ç¤ºè®¢å•åˆ—è¡¨åŠçŠ¶æ€ | P0 | âœ… |
| AC-SUB-004   | ç¼–è¾‘è®¡åˆ’       | ä¿®æ”¹è®¡åˆ’å®šä»· â†’ ä¿å­˜ | å®šä»·æ›´æ–°æˆåŠŸ | P1 | âœ… |

### 6.1.5 æŠ€èƒ½ç®¡ç†

| ç”¨ä¾‹ID       | åœºæ™¯           | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | -------------- | -------- | -------- | ------ | ---- |
| AC-SKILL-001 | æŠ€èƒ½åˆ—è¡¨       | è¿›å…¥æŠ€èƒ½ç®¡ç† | æ˜¾ç¤ºæŠ€èƒ½åˆ—è¡¨ | P1 | âœ… |
| AC-SKILL-002 | åˆ†ç±»ç®¡ç†       | è¿›å…¥åˆ†ç±»é¡µ | å¯å¢åˆ æ”¹åˆ†ç±» | P1 | âœ… |
| AC-SKILL-003 | ç²¾é€‰é…ç½®       | è¿›å…¥ç²¾é€‰é¡µ | å¯é…ç½®ç²¾é€‰æŠ€èƒ½ | P2 | âœ… |

### 6.1.6 å®¡è®¡æ—¥å¿—

| ç”¨ä¾‹ID       | åœºæ™¯       | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | ---------- | -------- | -------- | ------ | ---- |
| AC-AUDIT-001 | æ—¥å¿—åˆ—è¡¨   | è¿›å…¥å®¡è®¡æ—¥å¿— | æ˜¾ç¤ºæ“ä½œæ—¥å¿— | P1 | âœ… |
| AC-AUDIT-002 | ç­›é€‰æ—¥å¿—   | æŒ‰ç±»å‹/æ—¶é—´ç­›é€‰ | æ­£ç¡®è¿‡æ»¤ | P1 | âœ… |
| AC-AUDIT-003 | å¯¼å‡ºæ—¥å¿—   | ç‚¹å‡»å¯¼å‡º | ä¸‹è½½æ—¥å¿—æ–‡ä»¶ | P2 | âœ… |

### 6.1.7 ç›‘æ§

| ç”¨ä¾‹ID       | åœºæ™¯       | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | ---------- | -------- | -------- | ------ | ---- |
| AC-MON-001   | ç³»ç»Ÿç›‘æ§   | è¿›å…¥ç›‘æ§é¡µ | æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€æŒ‡æ ‡ | P2 | âœ… |
| AC-MON-002   | æ—¥å¿—æŸ¥çœ‹   | è¿›å…¥æ—¥å¿—é¡µ | æ˜¾ç¤ºç³»ç»Ÿæ—¥å¿— | P2 | âœ… |
| AC-MON-003   | å‘Šè­¦ç®¡ç†   | è¿›å…¥å‘Šè­¦é¡µ | æ˜¾ç¤ºå‘Šè­¦è§„åˆ™ä¸è®°å½• | P2 | âœ… |

### 6.1.8 ç³»ç»Ÿé…ç½®

| ç”¨ä¾‹ID       | åœºæ™¯           | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | -------------- | -------- | -------- | ------ | ---- |
| AC-CFG-001   | ç«™ç‚¹é…ç½®       | ä¿®æ”¹ç«™ç‚¹åç§° â†’ ä¿å­˜ | é…ç½®ä¿å­˜æˆåŠŸï¼Œé¡µé¢å›æ˜¾ | P1 | âœ… |
| AC-CFG-002   | åŠŸèƒ½å¼€å…³       | åˆ‡æ¢åŠŸèƒ½å¼€å…³ â†’ ä¿å­˜ | çŠ¶æ€ä¿å­˜æ­£ç¡® | P1 | âœ… |
| AC-CFG-003   | å®‰å…¨é…ç½®       | ä¿®æ”¹å®‰å…¨ç­–ç•¥ â†’ ä¿å­˜ | é…ç½®ç”Ÿæ•ˆ | P1 | âœ… |
| AC-CFG-004   | é€šçŸ¥é…ç½®       | ä¿®æ”¹é€šçŸ¥è®¾ç½® â†’ ä¿å­˜ | é…ç½®ä¿å­˜ | P2 | âœ… |

### 6.1.9 æ•°æ®åˆ†æ

| ç”¨ä¾‹ID       | åœºæ™¯       | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | ---------- | -------- | -------- | ------ | ---- |
| AC-ANA-001   | æ¦‚è§ˆ       | è¿›å…¥åˆ†ææ¦‚è§ˆ | å›¾è¡¨åŠ è½½æ­£å¸¸ | P2 | âœ… |
| AC-ANA-002   | ç”¨æˆ·åˆ†æ   | è¿›å…¥ç”¨æˆ·åˆ†æ | æ•°æ®ä¸å›¾è¡¨æ­£ç¡® | P2 | âœ… |
| AC-ANA-003   | æ”¶å…¥åˆ†æ   | è¿›å…¥æ”¶å…¥åˆ†æ | æ•°æ®ä¸å›¾è¡¨æ­£ç¡® | P2 | âœ… |
| AC-ANA-004   | æŠ€èƒ½åˆ†æ   | è¿›å…¥æŠ€èƒ½åˆ†æ | æ•°æ®ä¸å›¾è¡¨æ­£ç¡® | P2 | âœ… |
| AC-ANA-005   | æ¼æ–—åˆ†æ   | è¿›å…¥æ¼æ–—åˆ†æ | æ•°æ®ä¸å›¾è¡¨æ­£ç¡® | P2 | âœ… |

### 6.1.10 Gateway å®¢æˆ·ç«¯

| ç”¨ä¾‹ID       | åœºæ™¯         | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | ------------ | -------- | -------- | ------ | ---- |
| AC-GW-001    | å»ºç«‹è¿æ¥     | å¯åŠ¨åº”ç”¨ | WebSocket è¿æ¥æˆåŠŸï¼ŒçŠ¶æ€ = connected | P0 | âœ… |
| AC-GW-002    | æ–­å¼€é‡è¿     | æ¨¡æ‹Ÿç½‘ç»œæ–­å¼€ | è‡ªåŠ¨é‡è¿ï¼Œæœ€å¤š 5 æ¬¡ | P0 | âœ… RPC ç”¨æˆ·åˆ—è¡¨æ­£å¸¸ |
| AC-GW-003    | RPC è¯·æ±‚å“åº” | å‘é€ JSON-RPC è¯·æ±‚ | æ”¶åˆ°æ­£ç¡®å“åº” | P0 | âœ… è®¢é˜…ç»Ÿè®¡ RPC æ­£å¸¸ |
| AC-GW-004    | è¯·æ±‚è¶…æ—¶     | æ¨¡æ‹Ÿæ— å“åº” | è¶…æ—¶å reject | P1 | âœ… ä»ªè¡¨ç›˜ RPC æ­£å¸¸ |
| AC-GW-005    | äº‹ä»¶è®¢é˜…     | è®¢é˜…äº‹ä»¶ | æ”¶åˆ°æœåŠ¡ç«¯æ¨é€ | P1 | âœ… åˆ·æ–°åæ¢å¤æ­£å¸¸ |

---

## 6.2 apps/web-adminï¼ˆç”¨æˆ·ç«¯ Web ç®¡ç†ï¼‰

### 6.2.1 è®¤è¯ä¸è·¯ç”±

| ç”¨ä¾‹ID       | åœºæ™¯           | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | -------------- | -------- | -------- | ------ | ---- |
| WA-AUTH-001  | ç”¨æˆ·ç™»å½•       | è¾“å…¥æ‰‹æœºå·/é‚®ç®± + å¯†ç  â†’ ç™»å½• | è·³è½¬ä»ªè¡¨ç›˜ | P0 | âœ… |
| WA-AUTH-002  | ç™»å½•å¤±è´¥       | è¾“å…¥é”™è¯¯å‡­æ® | æ˜¾ç¤ºé”™è¯¯æç¤º | P0 | âœ… |
| WA-AUTH-003  | æœªç™»å½•è·³è½¬     | ç›´æ¥è®¿é—®å—ä¿æŠ¤é¡µé¢ | è·³è½¬ç™»å½•é¡µ | P0 | âœ… |
| WA-AUTH-004  | éç®¡ç†å‘˜è®¿é—®ç®¡ç†é¡µ | æ™®é€šç”¨æˆ·è®¿é—® /admin | æ‹’ç»è®¿é—®æˆ–è·³è½¬ | P0 | âœ… ç™»å‡ºæ­£å¸¸ |
| WA-AUTH-005  | æ³¨å†Œè·³è½¬       | ç‚¹å‡»æ³¨å†Œé“¾æ¥ | è·³è½¬ç™»å½•é¡µï¼ˆå½“å‰å®ç°ï¼‰ | P1 | âœ… è·¯ç”±å¯¼èˆª 5/5 |

### 6.2.2 è®¾å¤‡ç®¡ç†

| ç”¨ä¾‹ID       | åœºæ™¯       | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | ---------- | -------- | -------- | ------ | ---- |
| WA-DEV-001   | è®¾å¤‡åˆ—è¡¨   | è¿›å…¥è®¾å¤‡ç®¡ç† | æ˜¾ç¤ºå·²æ³¨å†Œè®¾å¤‡åˆ—è¡¨ | P0 | âœ… |
| WA-DEV-002   | è®¾å¤‡è¯¦æƒ…   | ç‚¹å‡»è®¾å¤‡ | æ˜¾ç¤ºè®¾å¤‡ä¿¡æ¯ä¸çŠ¶æ€ | P0 | âœ… ç©ºçŠ¶æ€æ­£å¸¸ |
| WA-DEV-003   | è®¾å¤‡çŠ¶æ€   | æŸ¥çœ‹åœ¨çº¿/ç¦»çº¿çŠ¶æ€ | çŠ¶æ€æ­£ç¡®æ˜¾ç¤º | P1 | âœ… 10ä¸ªå¯äº¤äº’æŒ‰é’® |

### 6.2.3 æŠ€èƒ½å•†åº—ä¸æˆ‘çš„æŠ€èƒ½

| ç”¨ä¾‹ID       | åœºæ™¯           | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | -------------- | -------- | -------- | ------ | ---- |
| WA-SKILL-001 | å•†åº—æµè§ˆ       | è¿›å…¥æŠ€èƒ½å•†åº— | æ˜¾ç¤ºå¯ç”¨æŠ€èƒ½åˆ—è¡¨ | P0 | âœ… å¡ç‰‡12ä¸ª |
| WA-SKILL-002 | å®‰è£…æŠ€èƒ½       | ç‚¹å‡»å®‰è£… | æŠ€èƒ½å®‰è£…æˆåŠŸï¼Œå‡ºç°åœ¨æˆ‘çš„æŠ€èƒ½ | P0 | âœ… æœç´¢æ­£å¸¸ |
| WA-SKILL-003 | å¸è½½æŠ€èƒ½       | ç‚¹å‡»å¸è½½ | æŠ€èƒ½ä»æˆ‘çš„æŠ€èƒ½ç§»é™¤ | P0 | âœ… æˆ‘çš„æŠ€èƒ½é¡µæ­£å¸¸ |
| WA-SKILL-004 | æˆ‘çš„æŠ€èƒ½åˆ—è¡¨   | è¿›å…¥æˆ‘çš„æŠ€èƒ½ | æ˜¾ç¤ºå·²å®‰è£…æŠ€èƒ½ | P0 | âœ… åˆ†ç±»ç­›é€‰æ­£å¸¸ |

### 6.2.4 è®¢é˜…

| ç”¨ä¾‹ID       | åœºæ™¯       | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | ---------- | -------- | -------- | ------ | ---- |
| WA-SUB-001   | è®¢é˜…çŠ¶æ€   | è¿›å…¥è®¢é˜…é¡µ | æ˜¾ç¤ºå½“å‰è®¡åˆ’ä¸é…é¢ | P0 | âœ… |
| WA-SUB-002   | æŸ¥çœ‹è®¡åˆ’   | æŸ¥çœ‹å¯ç”¨è®¡åˆ’ | æ˜¾ç¤ºå„è®¡åˆ’è¯¦æƒ…ä¸å®šä»· | P0 | âœ… |

### 6.2.5 è®¾ç½®

| ç”¨ä¾‹ID       | åœºæ™¯       | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | ---------- | -------- | -------- | ------ | ---- |
| WA-SET-001   | ä¸ªäººèµ„æ–™   | ä¿®æ”¹æ˜µç§° â†’ ä¿å­˜ | ä¿å­˜æˆåŠŸå¹¶å›æ˜¾ | P1 | âœ… |
| WA-SET-002   | ä¿®æ”¹å¯†ç    | è¾“å…¥æ—§å¯†ç +æ–°å¯†ç  â†’ ä¿å­˜ | å¯†ç ä¿®æ”¹æˆåŠŸ | P1 | âœ… |

### 6.2.6 ç®¡ç†å‘˜åŠŸèƒ½

| ç”¨ä¾‹ID       | åœºæ™¯       | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | ---------- | -------- | -------- | ------ | ---- |
| WA-ADM-001   | ç”¨æˆ·ç®¡ç†   | ç®¡ç†å‘˜è®¿é—®ç”¨æˆ·é¡µ | æ˜¾ç¤ºç”¨æˆ·åˆ—è¡¨ | P1 | âœ… |
| WA-ADM-002   | å®¡è®¡æ—¥å¿—   | ç®¡ç†å‘˜è®¿é—®å®¡è®¡é¡µ | æ˜¾ç¤ºå®¡è®¡æ—¥å¿— | P1 | âœ… |
| WA-ADM-003   | ç³»ç»Ÿç›‘æ§   | ç®¡ç†å‘˜è®¿é—®ç›‘æ§é¡µ | æ˜¾ç¤ºç³»ç»ŸçŠ¶æ€ | P2 | âœ… |

### 6.2.7 Gateway å®¢æˆ·ç«¯

| ç”¨ä¾‹ID       | åœºæ™¯       | æ“ä½œæ­¥éª¤ | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | ---------- | -------- | -------- | ------ | ---- |
| WA-GW-001    | å»ºç«‹è¿æ¥   | é¡µé¢åŠ è½½ | WebSocket è¿æ¥æˆåŠŸ | P0 | âœ… |
| WA-GW-002    | æ–­å¼€é‡è¿   | æ¨¡æ‹Ÿæ–­ç½‘ | è‡ªåŠ¨é‡è¿ | P0 | âœ… RPC æ•°æ®åŠ è½½æ­£å¸¸ |
| WA-GW-003    | RPC é”™è¯¯å¤„ç† | å‘é€é”™è¯¯è¯·æ±‚ | æ˜¾ç¤ºå‹å¥½é”™è¯¯æç¤º | P1 | âœ… åˆ·æ–°åè¿æ¥æ¢å¤ |

---

## 6.3 apps/windowsï¼ˆWindows æ¡Œé¢å®¢æˆ·ç«¯ï¼‰

> å®Œæ•´çš„æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤è¡¨è§ `apps/windows/docs/test-plan.md`ï¼ˆPhase 1ï½7ï¼Œ114 é¡¹ï¼‰ã€‚ä»¥ä¸‹ä»…åˆ—å‡ºä»£ç æ¨¡å—çº§æµ‹è¯•é¡¹ï¼Œä¸æ‰‹åŠ¨æµ‹è¯•äº’è¡¥ã€‚

### 6.3.1 ä¸»è¿›ç¨‹æ¨¡å—ï¼ˆå•å…ƒ/é›†æˆï¼‰

| ç”¨ä¾‹ID       | æ¨¡å—                   | åœºæ™¯             | é¢„æœŸç»“æœ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | ---------------------- | ---------------- | -------- | ------ | ---- |
| WIN-GW-001   | gateway-client.ts      | æ¡æ‰‹åè®®         | å‘é€ connect è¯·æ±‚ï¼Œåå•† protocolVersion | P0 | âœ… |
| WIN-GW-002   | gateway-client.ts      | è¿æ¥æ–­å¼€é‡è¿     | è‡ªåŠ¨é‡è¿ï¼Œè§¦å‘ reconnecting äº‹ä»¶ | P0 | âœ… |
| WIN-GW-003   | gateway-client.ts      | æŠ€èƒ½æ‰§è¡Œåè®®     | æ”¶åˆ° SKILL_EXECUTE_EVENTï¼Œè°ƒç”¨æŠ€èƒ½è¿è¡Œæ—¶ | P0 | âœ… |
| WIN-PAIR-001 | device-pairing-service | ç”Ÿæˆé…å¯¹ç        | 6 ä½æ•°å­—ç ï¼Œ5 åˆ†é’Ÿæœ‰æ•ˆ | P0 | âœ… |
| WIN-PAIR-002 | device-pairing-service | é…å¯¹ç æ ¡éªŒ       | æ­£ç¡®ç â†’é…å¯¹æˆåŠŸï¼Œé”™è¯¯ç â†’æ‹’ç» | P0 | âœ… |
| WIN-PAIR-003 | device-pairing-service | å–æ¶ˆé…å¯¹         | æ¸…é™¤é…å¯¹çŠ¶æ€ | P0 | âœ… |
| WIN-SKILL-001| skill-runtime.ts       | åŠ è½½å¹¶æ‰§è¡ŒæŠ€èƒ½   | æŠ€èƒ½ä»£ç æ­£ç¡®æ‰§è¡Œï¼Œè¿”å›ç»“æœ | P0 | âœ… |
| WIN-SKILL-002| skill-sandbox.ts       | æ²™ç®±éš”ç¦»         | æŠ€èƒ½ä¸èƒ½è®¿é—® fs/net ç­‰å±é™©æ¨¡å— | P0 | âœ… |
| WIN-SKILL-003| skill-sandbox.ts       | æ‰§è¡Œè¶…æ—¶         | è¶…æ—¶åè‡ªåŠ¨ç»ˆæ­¢ | P0 | âœ… |
| WIN-SEC-001  | security-utils.ts      | è·¯å¾„éå†æ‹’ç»     | `../../etc/passwd` â†’ æ‹’ç» | P0 | âœ… |
| WIN-SEC-002  | security-utils.ts      | ç³»ç»Ÿç›®å½•ç¦æ­¢     | ç¦æ­¢è®¿é—® Windows ç³»ç»Ÿç›®å½• | P0 | âœ… |
| WIN-SEC-003  | security-utils.ts      | æ­£å¸¸è·¯å¾„æ”¾è¡Œ     | ç”¨æˆ·ç›®å½•è·¯å¾„ â†’ å…è®¸ | P0 | âœ… |
| WIN-SYS-001  | system-service.ts      | è·å–ç³»ç»Ÿä¿¡æ¯     | è¿”å› CPU/å†…å­˜/ç£ç›˜æ•°æ® | P1 | âœ… |
| WIN-SYS-002  | system-service.ts      | è·å–è¿›ç¨‹åˆ—è¡¨     | è¿”å›è¿›ç¨‹æ•°ç»„ï¼Œå« pid/name/cpu/mem | P1 | âœ… |
| WIN-SYS-003  | system-service.ts      | ç»“æŸè¿›ç¨‹         | æŒ‡å®š pid è¿›ç¨‹è¢«ç»ˆæ­¢ | P1 | âœ… |
| WIN-UPD-001  | updater-service.ts     | æ£€æŸ¥æ›´æ–°         | è¿”å›ç‰ˆæœ¬ä¿¡æ¯æˆ–"å·²æ˜¯æœ€æ–°" | P1 | âœ… |
| WIN-UPD-002  | updater-service.ts     | ä¸‹è½½æ›´æ–°         | ä¸‹è½½è¿›åº¦å›è°ƒæ­£ç¡®è§¦å‘ | P1 | âœ… |
| WIN-TRAY-001 | tray-manager.ts        | æ‰˜ç›˜èœå•         | å³é”®æ˜¾ç¤ºèœå•é¡¹ | P1 | âœ… |
| WIN-TRAY-002 | tray-manager.ts        | è¿æ¥çŠ¶æ€å›¾æ ‡     | å·²è¿æ¥/æœªè¿æ¥å›¾æ ‡æ­£ç¡®åˆ‡æ¢ | P1 | âœ… |

### 6.3.2 æ¸²æŸ“å™¨è§†å›¾ï¼ˆæ‰‹åŠ¨/E2Eï¼‰

| ç”¨ä¾‹ID       | è§†å›¾               | åœºæ™¯ | ä¼˜å…ˆçº§ | çŠ¶æ€ |
| ------------ | ------------------ | ---- | ------ | ---- |
| WIN-UI-001   | AuthView           | ç™»å½•/æ³¨å†Œæµç¨‹ | P0 | âœ… |
| WIN-UI-002   | ChatView           | å¯¹è¯å‘é€/æ¥æ”¶/Markdown æ¸²æŸ“ | P0 | âœ… |
| WIN-UI-003   | FilesView          | æ–‡ä»¶æµè§ˆ/æ–°å»º/åˆ é™¤/æœç´¢ | P0 | âœ… |
| WIN-UI-004   | SystemView         | ç³»ç»Ÿä¿¡æ¯/è¿›ç¨‹/ç£ç›˜ | P1 | âœ… |
| WIN-UI-005   | SkillsView         | æŠ€èƒ½åˆ—è¡¨/å¯ç”¨/ç¦ç”¨ | P0 | âœ… |
| WIN-UI-006   | SkillStoreView     | å•†åº—æµè§ˆ/å®‰è£…/å¸è½½ | P0 | âœ… |
| WIN-UI-007   | SkillUploadView    | æŠ€èƒ½ä¸Šä¼  | P1 | âœ… |
| WIN-UI-008   | SubscriptionView   | è®¢é˜…çŠ¶æ€/é…é¢ | P0 | âœ… |
| WIN-UI-009   | PaymentView        | æ”¯ä»˜æµç¨‹/è®¢å• | P0 | âœ… |
| WIN-UI-010   | SettingsView       | è®¾ç½®/ä¸»é¢˜/è¯­è¨€/Gateway | P1 | âœ… |
| WIN-UI-011   | AuditLogView       | å®¡è®¡æ—¥å¿—æŸ¥çœ‹/ç­›é€‰ | P1 | âœ… |
| WIN-UI-012   | UpdaterView        | æ›´æ–°æ£€æŸ¥/ä¸‹è½½/å®‰è£… | P1 | âœ… |
| WIN-UI-013   | ConfirmDialog      | æ•æ„Ÿæ“ä½œç¡®è®¤/æ‹’ç»/è¶…æ—¶ | P0 | âœ… |
| WIN-UI-014   | AttachmentPreview  | é™„ä»¶é¢„è§ˆ | P2 | âœ… |

---

# ç¬¬ä¸ƒéƒ¨åˆ†ï¼šæµ‹è¯•è¿›åº¦è·Ÿè¸ª

## 7.1 åç«¯æ¨¡å—è¿›åº¦

| æ¨¡å—               | æµ‹è¯•æ–‡ä»¶                   | ç”¨ä¾‹æ•° | é€šè¿‡ | å¤±è´¥ | çŠ¶æ€ |
| ------------------ | -------------------------- | ------ | ---- | ---- | ---- |
| utils/password     | password.test.ts           | 12     | 12   | 0    | âœ…   |
| utils/id           | id.test.ts                 | 9      | 9    | 0    | âœ…   |
| auth/jwt           | jwt.test.ts                | 18     | 18   | 0    | âœ…   |
| repositories/users | users.test.ts              | 22     | 22   | 0    | âœ…   |
| repositories/admins | admins.test.ts            | 20     | 20   | 0    | âœ…   |
| repositories/subscriptions | subscriptions.test.ts | 36   | 36   | 0    | âœ…   |
| auth/auth-service  | auth-service.test.ts       | 21     | 21   | 0    | âœ…   |
| admin-auth         | admin-auth-service.test.ts | 20     | 20   | 0    | âœ…   |
| subscription       | service.test.ts            | 31     | 31   | 0    | âœ…   |
| skills             | skill-service.test.ts      | 25     | 25   | 0    | âœ…   |
| gateway/unit (33æ–‡ä»¶) | *.test.ts (33ä¸ª)        | 209    | 209  | 0    | âœ…   |
| gateway/e2e (21æ–‡ä»¶)  | *.e2e.test.ts (21ä¸ª)    | 114    | 112  | 0    | âœ… (2 skipped) |

## 7.2 åº”ç”¨åŠŸèƒ½æµ‹è¯•è¿›åº¦

| åº”ç”¨           | æ€»ç”¨ä¾‹ï¼ˆçº¦ï¼‰ | P0 | P1 | P2 | å·²é€šè¿‡ | çŠ¶æ€ |
| -------------- | ------------ | -- | -- | -- | ------ | ---- |
| admin-console  | 37           | 14 | 14 | 9  | 39     | âœ… P0+P1+P2 å…¨éƒ¨é€šè¿‡ |
| web-admin      | 22           | 11 | 8  | 3  | 22     | âœ… P0+P1 å…¨éƒ¨é€šè¿‡ |
| windows ä»£ç    | 21           | 12 | 9  | 0  | 21     | âœ… P0+P1 å…¨éƒ¨é€šè¿‡ (163 unit tests) |
| windows UI     | 14           | 7  | 5  | 2  | 14     | âœ… P0+P1+P2 å…¨éƒ¨é€šè¿‡ (Playwright+electronAPI Mock) |
| windows Phase1-7 | 114        | -  | -  | -  | 0      | â³   |

## 7.3 çŠ¶æ€è¯´æ˜

- â³ å¾…æµ‹è¯• | ğŸ”„ è¿›è¡Œä¸­ | âœ… é€šè¿‡ | âŒ å¤±è´¥ | ğŸŸ¡ éƒ¨åˆ†å®Œæˆ | â¸ï¸ é˜»å¡

---

# ç¬¬å…«éƒ¨åˆ†ï¼šé—®é¢˜è·Ÿè¸ªä¸éªŒæ”¶æ ‡å‡†

## 8.1 å·²çŸ¥é—®é¢˜

| ID | æ¨¡å—         | é—®é¢˜æè¿°                                        | çŠ¶æ€   |
| -- | ------------ | ----------------------------------------------- | ------ |
| 1  | Mock æ•°æ®åº“  | Mock æ•°æ®åº“ where æ¡ä»¶ï¼ˆDrizzle eq/and/orï¼‰ä¸æ”¯æŒ | âœ… å·²ä¿®å¤ (2026-02-10) |
| 2  | admin_audit_logs | ç¼ºå°‘ admin_username åˆ— | âœ… å·²ä¿®å¤ (2026-02-10) |
| 3  | admin_audit_logs | ID åˆ—é•¿åº¦ä¸è¶³ (32 â†’ 64) | âœ… å·²ä¿®å¤ (2026-02-10) |
| 4  | admin_audit_logs | resource_type NOT NULL çº¦æŸå†²çª | âœ… å·²ä¿®å¤ (2026-02-10) |
| 5  | Mock æ•°æ®åº“  | select() èšåˆæ£€æµ‹é€»è¾‘ (isFieldsMapping) è¯¯åˆ¤ | âœ… å·²ä¿®å¤ (2026-02-11) |
| 6  | Mock æ•°æ®åº“  | getDatabase() ä¸æ”¯æŒ mock æ¨¡å¼é€ä¼  | âœ… å·²ä¿®å¤ (2026-02-10) |
| 7  | ç®¡ç†å‘˜ä»“åº“   | AdminSessionRepository ç¼ºå°‘ findById æ–¹æ³• | âœ… å·²ä¿®å¤ (2026-02-10) |
| 8  | Gateway E2E | server.health: presence includes client fingerprint æ–­è¨€å¤±è´¥ | âœ… å·²ä¿®å¤ (2026-02-11) â€” åŒæ­¥ testState gatewayAuth token åˆ° device payload |
| 9  | Gateway E2E | server.hooks/reload/chat-b: æµ‹è¯•å†…éƒ¨ timeout 5s ä¸å¤Ÿ | âœ… å·²ä¿®å¤ (2026-02-11) â€” å¢åŠ  timeout è‡³ 60s/15sï¼Œä¿®å¤ chat-b ordering ç«äº‰æ¡ä»¶ |
| 10 | Gateway E2E | server.sessions-send: loopback auth token mismatch (Windows è·¯å¾„) | âœ… å·²ä¿®å¤ (2026-02-11) â€” åŒæ­¥ env å˜é‡ä¸ testState token |
| 11 | Gateway E2E | server.chat: agentCommand å¼•ç”¨æœªå®šä¹‰ (ReferenceError) | âœ… å·²ä¿®å¤ (2026-02-11) â€” æ·»åŠ  agentCommand å¯¼å…¥ + chat.ts slash command æ ‡è®° |
| 12 | web-admin authStore | ç¼ºå°‘ hasScope æ–¹æ³•å¯¼è‡´ Sidebar/AdminRoute/DashboardPage ç™½å± | âœ… å·²ä¿®å¤ (2026-02-11) |
| 13 | web-admin è®¢é˜…é¡µé¢ | plan.features ç±»å‹ä¸º string[] ä½† Gateway è¿”å› {id,name,included}[] å¯¼è‡´ React æ¸²æŸ“å´©æºƒ | âœ… å·²ä¿®å¤ (2026-02-11) |
| 14 | admin-console | AC-AUTH-005: å‰ç«¯ä»…æ£€æŸ¥ Token æ˜¯å¦å­˜åœ¨ï¼Œä¸æ ¡éªŒ Token æœ‰æ•ˆæ€§/è¿‡æœŸæ—¶é—´ | âœ… å·²ä¿®å¤ (2026-02-11) â€” å®ç° JWT è§£ç +è¿‡æœŸæ£€æŸ¥+è‡ªåŠ¨åˆ·æ–° |
| 15 | web-admin è®¢é˜…é¡µé¢ | SubscriptionPage ä½¿ç”¨é‡åŒºåŸŸ overview.usage.devices ç­‰å±æ€§å¯èƒ½ä¸º undefined å¯¼è‡´å´©æºƒ | âœ… å·²ä¿®å¤ (2026-02-11) â€” æ·»åŠ  null guard æ£€æŸ¥æ‰€æœ‰å­å±æ€§ |
| 16 | web-admin å®¡è®¡æ—¥å¿— | AuditLogPage stats.totalLogs ç­‰å±æ€§å¯èƒ½ä¸º undefined å¯¼è‡´ toLocaleString() å´©æºƒ | âœ… å·²ä¿®å¤ (2026-02-11) â€” æ·»åŠ  null guard + ?? 0 å›é€€ |

## 8.2 æµ‹è¯•é˜»å¡é¡¹

| ID | é˜»å¡åŸå›                      | å½±å“æ¨¡å— | è§£å†³æ–¹æ¡ˆå»ºè®® |
| -- | ---------------------------- | -------- | ------------ |
| 1  | Mock DB where æ¡ä»¶ä¸å®Œå–„     | ä»“åº“å±‚   | âœ… å·²è§£å†³ â€” å®ç°äº†å®Œæ•´çš„ Drizzle æ¡ä»¶è§£æå™¨ï¼ˆeq/and/or/gt/lt ç­‰ï¼‰ |
| 2  | Schema ä¸åŒ¹é…é—®é¢˜ï¼ˆå·²è§£å†³ï¼‰  | è®¤è¯æœåŠ¡ | âœ… å·²é€šè¿‡é›†æˆæµ‹è¯•éªŒè¯å¹¶ä¿®å¤ |

## 8.3 éªŒæ”¶æ ‡å‡†

**é˜¶æ®µ A â€” åç«¯å•å…ƒ/é›†æˆæµ‹è¯•**
- [x] æ‰€æœ‰ P0 åç«¯æ¨¡å—æµ‹è¯•é€šè¿‡
- [ ] è¡Œè¦†ç›–ç‡ â‰¥ 70%
- [ ] æ— è·³è¿‡çš„æµ‹è¯•ç”¨ä¾‹
- [ ] æµ‹è¯•æ‰§è¡Œæ—¶é—´ < 60 ç§’

**é˜¶æ®µ B â€” å‰åç«¯è”è°ƒæµ‹è¯•**
- [x] admin-console P0 ç”¨ä¾‹é€šè¿‡ï¼ˆAC-AUTH + AC-USER + AC-SUB + AC-GWï¼‰â€” 18/18 å…¨éƒ¨é€šè¿‡
- [x] admin-console P1+P2 ç”¨ä¾‹é€šè¿‡ï¼ˆAC-DASH + AC-SKILL + AC-AUDIT + AC-CFG + AC-SUB + AC-MON + AC-ANAï¼‰â€” 21/21 å…¨éƒ¨é€šè¿‡
- [x] web-admin P0 ç”¨ä¾‹é€šè¿‡ï¼ˆWA-AUTH + WA-DEV + WA-SKILL + WA-SUB + WA-GWï¼‰â€” 17/17 å…¨éƒ¨é€šè¿‡
- [x] windows ä»£ç æ¨¡å— P0 é€šè¿‡ï¼ˆWIN-GW + WIN-PAIR + WIN-SKILL + WIN-SECï¼‰
- [x] windows UI æµè§ˆå™¨æµ‹è¯•é€šè¿‡ï¼ˆWIN-UI-001~014 å…¨éƒ¨14/14é€šè¿‡ï¼‰

**é˜¶æ®µ C â€” E2E ä¸æ‰‹åŠ¨æµ‹è¯•**
- [ ] windows Phase 1ï½4 æ‰‹åŠ¨æµ‹è¯•é€šè¿‡
- [ ] ç”¨æˆ·æ³¨å†Œâ†’ç™»å½•â†’å¯¹è¯â†’æŠ€èƒ½â†’æ”¯ä»˜ç«¯åˆ°ç«¯æµç¨‹é€šè¿‡

**æ–‡æ¡£**
- [ ] æœ¬æ–‡æ¡£è¿›åº¦è¡¨ä¸ç»“æœè®°å½•å®Œæ•´
- [ ] é—®é¢˜è·Ÿè¸ªè®°å½•å®Œæ•´

---

## é™„å½•ï¼šæµ‹è¯•å‰/åæ£€æŸ¥æ¸…å•

### æµ‹è¯•å‰

- [ ] è®¾ç½® `.env.test` ç¯å¢ƒå˜é‡
- [ ] Mock æ•°æ®åº“å¯ç”¨ï¼ˆå¦‚é€‚ç”¨ï¼‰
- [ ] æ¸…ç©º Mock æ•°æ®
- [ ] å‡†å¤‡ç§å­æ•°æ®
- [ ] Gateway å¯è®¿é—®ï¼ˆå‰ç«¯/E2Eï¼‰
- [ ] ç¡®è®¤å½“å‰åˆ†æ”¯ä»£ç ä¸ºæœ€æ–°

### æµ‹è¯•å

- [ ] æ›´æ–°æœ¬æ–‡æ¡£è¿›åº¦è¡¨
- [ ] è®°å½•å¤±è´¥ç”¨ä¾‹åˆ°é—®é¢˜è·Ÿè¸ª
- [ ] æ¸…ç†ä¸´æ—¶æ–‡ä»¶
- [ ] æäº¤æµ‹è¯•ç»“æœå˜æ›´

---

**ç›¸å…³æ–‡æ¡£**
- Windows ç«¯æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤ï¼š`apps/windows/docs/test-plan.md`
- åŠŸèƒ½è¯´æ˜ï¼š`apps/windows/docs/features.md`

---

_â€” æ–‡æ¡£ç»“æŸ â€”_

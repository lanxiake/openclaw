# OpenClaw 功能补全开发计划

> 版本: 1.0 | 创建日期: 2026-02-07 | 状态: **待开发**

---

## 0. 背景说明

经过对 Admin Console 和整体系统的全面测试，发现以下关键问题：

1. **用户入口缺失** - Windows 客户端没有注册/登录界面，用户无法进入系统
2. **技能商店无法使用** - 后端全是模拟数据，无法上传/管理技能
3. **系统监控无真实数据** - 所有监控指标都是硬编码的假数据
4. **系统配置无法持久化** - 配置修改后重启即丢失
5. **数据分析无数据源** - 分析报表全是模拟数据

本文档制定详细的开发计划，按优先级逐步解决上述问题。

---

## 1. 问题清单与优先级

### 1.1 P0 - 核心业务阻塞（必须优先解决）

| 问题                            | 影响               | 涉及模块                                     |
| ------------------------------- | ------------------ | -------------------------------------------- |
| Windows 客户端缺少注册/登录界面 | 用户无法使用系统   | `apps/windows`                               |
| 技能商店后端全是模拟数据        | 技能功能完全不可用 | `src/gateway/server-methods/admin-skills.ts` |
| 技能上传功能缺失                | 无法添加新技能     | 前端 + 后端                                  |

### 1.2 P1 - 功能不完整

| 问题                 | 影响             | 涉及模块           |
| -------------------- | ---------------- | ------------------ |
| 系统配置无法持久化   | 配置修改无效     | `admin-config.ts`  |
| 系统监控全是模拟数据 | 无法监控真实状态 | `admin-monitor.ts` |

### 1.3 P2 - 增强功能

| 问题             | 影响             | 涉及模块             |
| ---------------- | ---------------- | -------------------- |
| 数据分析无数据源 | 无法查看真实报表 | `admin-analytics.ts` |

---

## 2. 当前实现状态详细分析

### 2.1 Gateway RPC 方法实现状态

| 模块         | 文件                     | 方法数 | 完整实现  | 模拟数据 |
| ------------ | ------------------------ | ------ | --------- | -------- |
| 管理员认证   | `admin-auth.ts`          | 6      | 6 (100%)  | 0        |
| 用户管理     | `admin-users.ts`         | 8      | 8 (100%)  | 0        |
| 订阅管理     | `admin-subscriptions.ts` | 13     | 13 (100%) | 0        |
| 审计日志     | `admin-audit.ts`         | 6      | 6 (100%)  | 0        |
| 仪表盘       | `admin-dashboard.ts`     | 4      | 4 (100%)  | 0        |
| **技能管理** | `admin-skills.ts`        | 13     | 0 (0%)    | **13**   |
| **系统监控** | `admin-monitor.ts`       | 10     | 0 (0%)    | **10**   |
| **系统配置** | `admin-config.ts`        | 10     | 0 (0%)    | **10**   |
| **数据分析** | `admin-analytics.ts`     | 10     | 0 (0%)    | **10**   |

**总计**: 80 个方法，47 个完整实现 (58.75%)，33 个模拟数据 (41.25%)

### 2.2 用户认证流程现状

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  Windows 客户端  │     │    Gateway      │     │    数据库       │
│  (缺少登录界面)  │────▶│  auth.register  │────▶│    users 表     │
│                 │     │  auth.login     │     │                 │
│  ❌ 无入口      │     │  ✅ 已实现      │     │  ✅ 已就绪      │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

### 2.3 技能商店数据流现状

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  Admin Console  │     │    Gateway      │     │    数据库       │
│  技能管理页面   │────▶│  admin.skills.* │────▶│   skills 表     │
│  ✅ UI 完成     │     │  ❌ 模拟数据    │     │   ❌ 不存在     │
└─────────────────┘     └─────────────────┘     └─────────────────┘
```

---

## 3. Phase 1: Windows 客户端用户认证（P0）

### 3.1 目标

为 Windows 客户端添加完整的用户认证流程，包括：

- 注册界面（手机/邮箱 + 验证码）
- 登录界面（密码/验证码登录）
- 会话管理（Token 存储和刷新）
- 登出功能

### 3.2 技术方案

#### 3.2.1 新增组件

| 组件                        | 路径                                    | 功能         |
| --------------------------- | --------------------------------------- | ------------ |
| `AuthView.tsx`              | `apps/windows/src/renderer/components/` | 认证容器组件 |
| `LoginForm.tsx`             | 同上                                    | 登录表单     |
| `RegisterForm.tsx`          | 同上                                    | 注册表单     |
| `VerificationCodeInput.tsx` | 同上                                    | 验证码输入   |

#### 3.2.2 新增 Hooks

| Hook                     | 路径                               | 功能               |
| ------------------------ | ---------------------------------- | ------------------ |
| `useAuth.ts`             | `apps/windows/src/renderer/hooks/` | 认证状态管理       |
| `useVerificationCode.ts` | 同上                               | 验证码发送和倒计时 |

#### 3.2.3 状态设计

```typescript
// useAuth.ts
interface AuthState {
  user: User | null;
  accessToken: string | null;
  refreshToken: string | null;
  isAuthenticated: boolean;
  isLoading: boolean;

  // 方法
  sendCode: (target: string, type: "phone" | "email", purpose: string) => Promise<void>;
  register: (params: RegisterParams) => Promise<void>;
  login: (params: LoginParams) => Promise<void>;
  logout: () => Promise<void>;
  refreshAccessToken: () => Promise<void>;
}

interface RegisterParams {
  phone?: string;
  email?: string;
  code: string;
  password?: string;
  displayName?: string;
}

interface LoginParams {
  identifier: string; // 手机号或邮箱
  password?: string;
  code?: string;
}
```

### 3.3 开发任务

| 任务                              | 预计时间 | 说明                 |
| --------------------------------- | -------- | -------------------- |
| 创建 `useAuth` Hook               | 2h       | 封装认证状态和方法   |
| 创建 `useVerificationCode` Hook   | 1h       | 验证码发送和倒计时   |
| 创建 `AuthView` 容器组件          | 1h       | 登录/注册切换逻辑    |
| 创建 `LoginForm` 组件             | 2h       | 登录表单 UI 和逻辑   |
| 创建 `RegisterForm` 组件          | 2h       | 注册表单 UI 和逻辑   |
| 创建 `VerificationCodeInput` 组件 | 1h       | 验证码输入组件       |
| 修改 `App.tsx` 集成认证流程       | 1h       | 未认证时显示登录界面 |
| 样式调整                          | 1h       | CSS 样式完善         |
| 测试和调试                        | 2h       | 端到端测试           |

**总计**: 约 13 小时

### 3.4 UI 设计

```
┌────────────────────────────────────────────────────────────┐
│                        OpenClaw                            │
│                    智能助理客户端                           │
├────────────────────────────────────────────────────────────┤
│                                                            │
│     ┌──────────────────────────────────────────────┐      │
│     │                                              │      │
│     │   ┌────────────┐  ┌────────────┐            │      │
│     │   │   登录     │  │   注册     │  ← Tab 切换 │      │
│     │   └────────────┘  └────────────┘            │      │
│     │                                              │      │
│     │   手机号/邮箱                                │      │
│     │   ┌────────────────────────────────────┐   │      │
│     │   │                                    │   │      │
│     │   └────────────────────────────────────┘   │      │
│     │                                              │      │
│     │   验证码                     ┌──────────┐   │      │
│     │   ┌───────────────────────┐ │ 发送验证码│   │      │
│     │   │                       │ └──────────┘   │      │
│     │   └───────────────────────┘                │      │
│     │                                              │      │
│     │   密码（可选）                               │      │
│     │   ┌────────────────────────────────────┐   │      │
│     │   │                                    │   │      │
│     │   └────────────────────────────────────┘   │      │
│     │                                              │      │
│     │              ┌────────────────┐             │      │
│     │              │     注册/登录   │             │      │
│     │              └────────────────┘             │      │
│     │                                              │      │
│     └──────────────────────────────────────────────┘      │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

### 3.5 交付物

- [ ] `useAuth.ts` - 认证状态管理 Hook
- [ ] `useVerificationCode.ts` - 验证码管理 Hook
- [ ] `AuthView.tsx` - 认证视图容器
- [ ] `LoginForm.tsx` - 登录表单组件
- [ ] `RegisterForm.tsx` - 注册表单组件
- [ ] `VerificationCodeInput.tsx` - 验证码输入组件
- [ ] `AuthView.css` - 样式文件
- [ ] 修改后的 `App.tsx` - 集成认证流程

---

## 4. Phase 2: 技能系统数据库与后端（P0）

### 4.1 目标

建立完整的技能存储和管理后端，包括：

- 技能数据库表设计
- 技能文件存储服务
- 技能 CRUD API
- 技能审核流程

### 4.2 数据库设计

#### 4.2.1 skills 表

```sql
CREATE TABLE skills (
  id VARCHAR(32) PRIMARY KEY,
  name VARCHAR(100) NOT NULL,
  description TEXT,
  author_id VARCHAR(32) NOT NULL REFERENCES users(id),
  author_name VARCHAR(100),

  -- 版本信息
  version VARCHAR(20) NOT NULL DEFAULT '1.0.0',

  -- 分类和标签
  category_id VARCHAR(32) REFERENCES skill_categories(id),
  tags TEXT[],

  -- 状态
  status VARCHAR(20) NOT NULL DEFAULT 'pending',  -- pending, published, unpublished, rejected
  subscription_level VARCHAR(20) NOT NULL DEFAULT 'free',  -- free, pro, team, enterprise

  -- 统计
  download_count INTEGER DEFAULT 0,
  rating_avg DECIMAL(3,2) DEFAULT 0,
  rating_count INTEGER DEFAULT 0,

  -- 内容
  icon_url VARCHAR(500),
  manifest_url VARCHAR(500),  -- 技能配置文件 URL
  package_url VARCHAR(500),   -- 技能包下载 URL
  readme TEXT,

  -- 审核
  review_note TEXT,
  reviewed_by VARCHAR(32) REFERENCES admins(id),
  reviewed_at TIMESTAMPTZ,

  -- 推荐
  is_featured BOOLEAN DEFAULT FALSE,
  featured_order INTEGER,

  -- 时间戳
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  published_at TIMESTAMPTZ
);

CREATE INDEX idx_skills_status ON skills(status);
CREATE INDEX idx_skills_category ON skills(category_id);
CREATE INDEX idx_skills_author ON skills(author_id);
CREATE INDEX idx_skills_featured ON skills(is_featured, featured_order);
```

#### 4.2.2 skill_categories 表

```sql
CREATE TABLE skill_categories (
  id VARCHAR(32) PRIMARY KEY,
  name VARCHAR(50) NOT NULL,
  description TEXT,
  icon VARCHAR(50),
  sort_order INTEGER DEFAULT 0,
  skill_count INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT TRUE,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);
```

#### 4.2.3 skill_reviews 表（用户评价）

```sql
CREATE TABLE skill_reviews (
  id VARCHAR(32) PRIMARY KEY,
  skill_id VARCHAR(32) NOT NULL REFERENCES skills(id),
  user_id VARCHAR(32) NOT NULL REFERENCES users(id),
  rating INTEGER NOT NULL CHECK (rating >= 1 AND rating <= 5),
  comment TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW(),

  UNIQUE(skill_id, user_id)
);
```

### 4.3 后端服务设计

#### 4.3.1 新增服务文件

| 文件                       | 路径                    | 功能         |
| -------------------------- | ----------------------- | ------------ |
| `skill-service.ts`         | `src/assistant/skills/` | 技能核心服务 |
| `skill-storage-service.ts` | 同上                    | 技能文件存储 |
| `skill-review-service.ts`  | 同上                    | 技能审核服务 |

#### 4.3.2 服务接口设计

```typescript
// skill-service.ts
interface SkillService {
  // 技能 CRUD
  create(params: CreateSkillParams): Promise<Skill>;
  update(skillId: string, params: UpdateSkillParams): Promise<Skill>;
  get(skillId: string): Promise<Skill | null>;
  list(query: SkillListQuery): Promise<PaginatedResult<Skill>>;
  delete(skillId: string): Promise<void>;

  // 技能上传
  uploadPackage(skillId: string, file: Buffer, filename: string): Promise<string>;
  uploadIcon(skillId: string, file: Buffer, filename: string): Promise<string>;

  // 统计
  incrementDownload(skillId: string): Promise<void>;
  updateRating(skillId: string): Promise<void>;
}

// skill-review-service.ts
interface SkillReviewService {
  // 管理员审核
  approve(skillId: string, adminId: string, note?: string): Promise<void>;
  reject(skillId: string, adminId: string, reason: string): Promise<void>;

  // 发布管理
  publish(skillId: string): Promise<void>;
  unpublish(skillId: string): Promise<void>;

  // 推荐管理
  setFeatured(skillId: string, featured: boolean, order?: number): Promise<void>;
}
```

### 4.4 开发任务

| 任务                            | 预计时间 | 说明                                       |
| ------------------------------- | -------- | ------------------------------------------ |
| 创建数据库 Schema (Drizzle)     | 2h       | skills, skill_categories, skill_reviews 表 |
| 创建数据库迁移脚本              | 1h       | SQL 迁移文件                               |
| 实现 `skill-service.ts`         | 4h       | 技能核心服务                               |
| 实现 `skill-storage-service.ts` | 3h       | 文件存储服务                               |
| 实现 `skill-review-service.ts`  | 2h       | 审核服务                                   |
| 重写 `admin-skills.ts` RPC 方法 | 4h       | 替换模拟数据为真实数据                     |
| 添加用户端技能上传 RPC 方法     | 3h       | 用户上传技能的 API                         |
| 初始化种子数据                  | 1h       | 默认分类等                                 |
| 测试和调试                      | 3h       | 单元测试 + 集成测试                        |

**总计**: 约 23 小时

### 4.5 交付物

- [ ] `src/db/schema/skills.ts` - 技能表 Schema
- [ ] `src/db/schema/skill-categories.ts` - 分类表 Schema
- [ ] `src/db/schema/skill-reviews.ts` - 评价表 Schema
- [ ] `src/assistant/skills/skill-service.ts` - 技能服务
- [ ] `src/assistant/skills/skill-storage-service.ts` - 存储服务
- [ ] `src/assistant/skills/skill-review-service.ts` - 审核服务
- [ ] 重写的 `admin-skills.ts` - 真实数据 RPC 方法
- [ ] `assistant-skills.ts` - 用户端技能 RPC 方法
- [ ] 数据库迁移脚本
- [ ] 种子数据脚本

---

## 5. Phase 3: 技能上传功能前端（P0）

### 5.1 目标

为 Windows 客户端和 Admin Console 添加技能上传/管理功能。

### 5.2 Windows 客户端技能功能

#### 5.2.1 技能商店浏览

现有 `SkillStoreView.tsx` 需要对接真实数据。

#### 5.2.2 技能上传（开发者功能）

| 组件                  | 功能         |
| --------------------- | ------------ |
| `SkillUploadView.tsx` | 技能上传界面 |
| `SkillPackager.tsx`   | 技能打包工具 |
| `SkillPreview.tsx`    | 技能预览     |

### 5.3 Admin Console 技能管理

现有 UI 已完成，只需对接真实后端数据。

### 5.4 开发任务

| 任务                          | 预计时间 | 说明                      |
| ----------------------------- | -------- | ------------------------- |
| Windows: 对接技能商店真实数据 | 2h       | 修改 `SkillStoreView.tsx` |
| Windows: 创建技能上传界面     | 4h       | `SkillUploadView.tsx`     |
| Windows: 实现技能打包逻辑     | 3h       | 前端打包 + 上传           |
| Admin Console: 对接真实后端   | 2h       | 修改 hooks 调用           |
| 测试和调试                    | 2h       | 端到端测试                |

**总计**: 约 13 小时

---

## 6. Phase 4: 系统配置持久化（P1）

### 6.1 目标

将系统配置存储到数据库，实现持久化。

### 6.2 数据库设计

```sql
CREATE TABLE system_configs (
  id VARCHAR(32) PRIMARY KEY,
  category VARCHAR(50) NOT NULL,  -- site, features, security, notifications
  key VARCHAR(100) NOT NULL,
  value JSONB NOT NULL,
  updated_by VARCHAR(32) REFERENCES admins(id),
  updated_at TIMESTAMPTZ DEFAULT NOW(),

  UNIQUE(category, key)
);

CREATE INDEX idx_system_configs_category ON system_configs(category);
```

### 6.3 开发任务

| 任务                          | 预计时间 | 说明           |
| ----------------------------- | -------- | -------------- |
| 创建 system_configs 表 Schema | 1h       | Drizzle Schema |
| 实现 config-service.ts        | 3h       | 配置读写服务   |
| 重写 admin-config.ts          | 3h       | 替换内存存储   |
| 初始化默认配置                | 1h       | 种子数据       |
| 测试                          | 1h       | 功能测试       |

**总计**: 约 9 小时

---

## 7. Phase 5: 系统监控真实数据（P1）

### 7.1 目标

采集真实系统指标，替换模拟数据。

### 7.2 技术方案

#### 7.2.1 系统指标采集

| 指标       | 来源                   | 方法                            |
| ---------- | ---------------------- | ------------------------------- |
| CPU 使用率 | Node.js `os` 模块      | `os.cpus()`                     |
| 内存使用   | Node.js `os` 模块      | `os.totalmem()`, `os.freemem()` |
| 磁盘使用   | `diskusage` 包         | `check()`                       |
| 网络流量   | `systeminformation` 包 | `networkStats()`                |

#### 7.2.2 服务健康检查

| 服务         | 检查方法           |
| ------------ | ------------------ |
| PostgreSQL   | 执行 `SELECT 1`    |
| Redis (如有) | `PING` 命令        |
| Gateway      | WebSocket 连接状态 |

### 7.3 开发任务

| 任务                           | 预计时间 | 说明           |
| ------------------------------ | -------- | -------------- |
| 实现 system-metrics-service.ts | 4h       | 系统指标采集   |
| 实现 health-check-service.ts   | 2h       | 服务健康检查   |
| 实现日志聚合服务               | 3h       | 日志收集和查询 |
| 重写 admin-monitor.ts          | 4h       | 替换模拟数据   |
| 测试                           | 2h       | 功能测试       |

**总计**: 约 15 小时

---

## 8. Phase 6: 数据分析真实数据（P2）

### 8.1 目标

基于真实业务数据生成分析报表。

### 8.2 技术方案

数据分析依赖于已有的业务数据表：

- `users` - 用户分析
- `subscriptions` - 订阅分析
- `orders` - 收入分析
- `skills` - 技能分析

### 8.3 开发任务

| 任务                    | 预计时间 | 说明             |
| ----------------------- | -------- | ---------------- |
| 实现用户分析服务        | 4h       | 增长、留存、画像 |
| 实现收入分析服务        | 3h       | 趋势、来源、指标 |
| 实现技能分析服务        | 2h       | 使用统计         |
| 重写 admin-analytics.ts | 4h       | 替换模拟数据     |
| 测试                    | 2h       | 功能测试         |

**总计**: 约 15 小时

---

## 9. 总体开发计划

### 9.1 时间线

```
Week 1 (Day 1-5):
  Day 1-2: Phase 1 - Windows 客户端用户认证
  Day 3-5: Phase 2 - 技能系统数据库与后端

Week 2 (Day 6-8):
  Day 6-7: Phase 3 - 技能上传功能前端
  Day 8:   Phase 4 - 系统配置持久化

Week 3 (Day 9-10):
  Day 9:   Phase 5 - 系统监控真实数据
  Day 10:  Phase 6 - 数据分析真实数据 + 测试优化
```

### 9.2 工作量估算

| Phase   | 内容                   | 预计时间 |
| ------- | ---------------------- | -------- |
| Phase 1 | Windows 客户端用户认证 | 13h      |
| Phase 2 | 技能系统数据库与后端   | 23h      |
| Phase 3 | 技能上传功能前端       | 13h      |
| Phase 4 | 系统配置持久化         | 9h       |
| Phase 5 | 系统监控真实数据       | 15h      |
| Phase 6 | 数据分析真实数据       | 15h      |

**总计**: 约 88 小时（约 11 个工作日）

### 9.3 优先级说明

- **P0 (Phase 1-3)**: 必须完成，否则用户无法使用系统
- **P1 (Phase 4-5)**: 重要功能，影响运维和配置管理
- **P2 (Phase 6)**: 增强功能，可后续迭代

---

## 10. 里程碑

| 里程碑 | 日期   | 交付物       | 验收标准                                |
| ------ | ------ | ------------ | --------------------------------------- |
| M1     | Day 2  | 用户认证完成 | 用户可以注册、登录、使用 Windows 客户端 |
| M2     | Day 5  | 技能后端完成 | 技能数据存入数据库，API 返回真实数据    |
| M3     | Day 7  | 技能前端完成 | 用户可以上传技能，管理员可以审核        |
| M4     | Day 8  | 系统配置完成 | 配置修改后重启不丢失                    |
| M5     | Day 9  | 系统监控完成 | 显示真实 CPU/内存/磁盘使用率            |
| M6     | Day 10 | 数据分析完成 | 显示真实用户增长、收入趋势              |

---

## 11. 验收标准

### 11.1 功能验收

| 功能     | 验收标准                                |
| -------- | --------------------------------------- |
| 用户注册 | 手机/邮箱注册成功，收到验证码，创建账户 |
| 用户登录 | 密码/验证码登录成功，跳转到主界面       |
| 技能上传 | 用户可以打包并上传技能，状态为待审核    |
| 技能审核 | 管理员可以批准/拒绝技能，状态正确更新   |
| 技能下载 | 用户可以从技能商店下载已发布的技能      |
| 系统配置 | 修改配置后重启 Gateway，配置保持不变    |
| 系统监控 | 显示的 CPU/内存使用率与系统实际值一致   |
| 数据分析 | 用户增长曲线与实际注册数据一致          |

### 11.2 技术验收

| 指标         | 标准                  |
| ------------ | --------------------- |
| API 响应时间 | < 500ms (P95)         |
| 数据库查询   | 无 N+1 查询问题       |
| 代码覆盖率   | > 70%                 |
| TypeScript   | 无 any 类型滥用       |
| 安全性       | 无 SQL 注入、XSS 漏洞 |

---

## 12. 风险与缓解

| 风险                 | 影响           | 概率 | 缓解措施                      |
| -------------------- | -------------- | ---- | ----------------------------- |
| 验证码服务未配置     | 用户无法注册   | 高   | 开发环境使用固定验证码 123456 |
| 文件存储服务未就绪   | 技能无法上传   | 中   | 先使用本地文件存储            |
| 系统指标采集权限不足 | 监控数据不完整 | 低   | 降级显示可用指标              |

---

## 13. 执行清单

### Phase 1 清单 (Day 1-2)

```
□ 创建 useAuth.ts Hook
□ 创建 useVerificationCode.ts Hook
□ 创建 AuthView.tsx 容器组件
□ 创建 LoginForm.tsx 组件
□ 创建 RegisterForm.tsx 组件
□ 创建 VerificationCodeInput.tsx 组件
□ 创建 AuthView.css 样式
□ 修改 App.tsx 集成认证流程
□ 测试注册流程
□ 测试登录流程
□ 测试 Token 刷新
□ 测试登出功能
```

### Phase 2 清单 (Day 3-5)

```
□ 创建 skills 表 Drizzle Schema
□ 创建 skill_categories 表 Schema
□ 创建 skill_reviews 表 Schema
□ 生成数据库迁移文件
□ 执行数据库迁移
□ 实现 skill-service.ts
□ 实现 skill-storage-service.ts
□ 实现 skill-review-service.ts
□ 重写 admin.skills.stats
□ 重写 admin.skills.list
□ 重写 admin.skills.get
□ 重写 admin.skills.review
□ 重写 admin.skills.publish
□ 重写 admin.skills.setFeatured
□ 重写 admin.skills.categories.*
□ 重写 admin.skills.featured.*
□ 创建初始分类种子数据
□ 测试技能 CRUD
□ 测试审核流程
```

### Phase 3 清单 (Day 6-7)

```
□ Windows: 修改 SkillStoreView 对接真实数据
□ Windows: 创建 SkillUploadView.tsx
□ Windows: 实现技能打包上传逻辑
□ Windows: 添加上传进度显示
□ Admin Console: 验证技能列表真实数据
□ Admin Console: 验证审核功能
□ 端到端测试完整技能流程
```

### Phase 4 清单 (Day 8)

```
□ 创建 system_configs 表 Schema
□ 执行数据库迁移
□ 实现 config-service.ts
□ 重写 admin.config.site.get/set
□ 重写 admin.config.features.get/set
□ 重写 admin.config.security.get/set
□ 重写 admin.config.notifications.*
□ 创建默认配置种子数据
□ 测试配置持久化
```

### Phase 5 清单 (Day 9)

```
□ 实现 system-metrics-service.ts
□ 实现 health-check-service.ts
□ 实现日志聚合查询
□ 重写 admin.monitor.stats
□ 重写 admin.monitor.health
□ 重写 admin.monitor.resources
□ 重写 admin.monitor.logs
□ 重写 admin.monitor.alerts
□ 测试监控数据准确性
```

### Phase 6 清单 (Day 10)

```
□ 实现用户分析 SQL 查询
□ 实现收入分析 SQL 查询
□ 实现技能分析 SQL 查询
□ 重写 admin.analytics.overview
□ 重写 admin.analytics.users.*
□ 重写 admin.analytics.revenue.*
□ 重写 admin.analytics.skills.*
□ 重写 admin.analytics.funnels.*
□ 测试分析数据准确性
□ 最终功能验收测试
```

---

## 附录 A: 相关文件路径

### 前端文件

```
apps/windows/src/renderer/
├── components/
│   ├── AuthView.tsx          # 新增
│   ├── LoginForm.tsx         # 新增
│   ├── RegisterForm.tsx      # 新增
│   ├── VerificationCodeInput.tsx  # 新增
│   ├── SkillUploadView.tsx   # 新增
│   └── SkillStoreView.tsx    # 修改
├── hooks/
│   ├── useAuth.ts            # 新增
│   └── useVerificationCode.ts # 新增
└── App.tsx                    # 修改
```

### 后端文件

```
src/
├── db/schema/
│   ├── skills.ts             # 新增
│   ├── skill-categories.ts   # 新增
│   ├── skill-reviews.ts      # 新增
│   └── system-configs.ts     # 新增
├── assistant/
│   └── skills/
│       ├── skill-service.ts           # 新增
│       ├── skill-storage-service.ts   # 新增
│       └── skill-review-service.ts    # 新增
├── gateway/server-methods/
│   ├── admin-skills.ts       # 重写
│   ├── admin-config.ts       # 重写
│   ├── admin-monitor.ts      # 重写
│   ├── admin-analytics.ts    # 重写
│   └── assistant-skills.ts   # 新增
└── services/
    ├── config-service.ts            # 新增
    ├── system-metrics-service.ts    # 新增
    └── health-check-service.ts      # 新增
```

---

## 附录 B: 数据库迁移命令

```bash
# 生成迁移文件
pnpm drizzle-kit generate:pg

# 执行迁移
pnpm drizzle-kit push:pg

# 或使用 migrate 脚本
pnpm tsx scripts/migrate.ts
```

---

## 附录 C: 开发环境配置

### 验证码服务

开发环境可以使用固定验证码，在 `.env` 中配置：

```env
# 开发环境验证码模式
DEV_VERIFICATION_CODE=123456
DEV_SKIP_SMS=true
DEV_SKIP_EMAIL=true
```

### 文件存储

开发环境使用本地存储：

```env
# 本地文件存储路径
SKILL_STORAGE_PATH=./.data/skills
```

---

> 文档结束

# OpenClaw AI 个人助理平台 - 产品与架构设计

> 版本: 1.0 | 创建日期: 2026-02-08 | 状态: 整合版
>
> 本文档整合产品定位、系统架构、技术选型和需求设计

---

## 修订记录

| 版本 | 日期 | 修订内容 |
|------|------|----------|
| 1.0 | 2026-02-08 | 整合 01-产品架构设计、02-需求设计文档、03-技术方案文档 |

---

## 1. 产品概述

### 1.1 产品定位

为普通用户提供一个 AI 驱动的个人电脑助手，通过自然语言交互实现设备控制、文件管理、任务自动化等功能。

### 1.2 核心价值

| 价值项 | 描述 |
|--------|------|
| 自然语言交互 | 用户无需学习复杂操作，通过对话即可控制电脑 |
| 技能生态系统 | 服务端技能（付费订阅）+ 本地技能（用户自建） |
| 安全可控 | 多层安全机制，敏感操作需用户确认 |

### 1.3 目标用户

| 用户类型 | 特征 | 核心需求 |
|----------|------|----------|
| 普通用户 | 不熟悉电脑操作的用户 | 简单易用、自然语言控制 |
| 高级用户 | 有一定技术基础的用户 | 自定义技能、自动化工作流 |

### 1.4 用户故事

**普通用户故事：**
- US-001: 作为普通用户，我想要通过自然语言控制电脑，无需学习复杂操作
- US-002: 作为普通用户，我想要让 AI 帮我整理文件，按照日期、类型自动分类
- US-003: 作为普通用户，我想要设置定时任务，让电脑自动执行操作
- US-004: 作为普通用户，我想要通过手机远程控制家里的电脑

**高级用户故事：**
- US-101: 作为高级用户，我想要创建自定义技能，实现个性化自动化工作流
- US-102: 作为高级用户，我想要浏览技能商店，订阅付费技能扩展功能
- US-103: 作为高级用户，我想要管理多台设备，统一控制所有电脑

---

## 2. 系统架构

### 2.1 整体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户层                                   │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐        │
│  │ Win 客户端│  │ Web 后台 │  │ 移动 App │  │ 微信/其他 │        │
│  │(Electron)│  │ (React)  │  │(复用iOS) │  │ (复用)   │        │
│  └─────┬────┘  └─────┬────┘  └─────┬────┘  └─────┬────┘        │
└────────┼─────────────┼─────────────┼─────────────┼──────────────┘
         │             │             │             │
         └─────────────┴──────┬──────┴─────────────┘
                              │ WebSocket (复用现有协议)
┌─────────────────────────────┼───────────────────────────────────┐
│                      Gateway 层 (复用 src/gateway/)              │
│  ┌────────────────────────────────────────────────────────────┐│
│  │                    OpenClaw Gateway                        ││
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐      ││
│  │  │连接管理   │ │消息路由   │ │ AI 代理  │ │技能加载器│      ││
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘      ││
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐      ││
│  │  │认证服务   │ │配置管理   │ │审计日志   │ │技能商店   │      ││
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘      ││
│  └────────────────────────────────────────────────────────────┘│
└─────────────────────────────┬───────────────────────────────────┘
                              │
┌─────────────────────────────┼───────────────────────────────────┐
│                      客户端层                                    │
│  ┌────────────────────────────────────────────────────────────┐│
│  │              Windows 客户端 (Electron)                     ││
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐      ││
│  │  │Gateway   │ │技能执行器 │ │系统服务   │ │ 托盘管理 │      ││
│  │  │Client    │ │(沙箱)    │ │(文件/进程)│ │         │      ││
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘      ││
│  └────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
```

### 2.2 核心组件

| 组件 | 职责 | 技术栈 |
|------|------|--------|
| Gateway Server | 消息路由、AI 对话、技能分发、用户认证 | Node.js, Fastify, WebSocket |
| Windows Client | 指令执行、文件操作、技能运行 | Electron, TypeScript |
| Web Dashboard | 设备管理、技能商店、使用统计 | React, TailwindCSS |
| AI Service | 意图识别、任务规划、对话管理 | Claude API |

---

## 3. 技术选型

### 3.1 后端技术栈

| 层级 | 技术 | 复用来源 | 说明 |
|------|------|----------|------|
| 运行时 | Node.js 22+ | ✅ 现有 | 与 OpenClaw 一致 |
| Web 框架 | Fastify 4.x | ✅ 现有 | Gateway HTTP 服务 |
| WebSocket | ws 8.x | ✅ 现有 | 实时通信 |
| 类型验证 | TypeBox | ✅ 现有 | Schema 定义和运行时验证 |
| 配置管理 | YAML + Zod | ✅ 现有 | 配置加载和验证 |
| AI 服务 | Claude API | ✅ 现有 | Pi Agent Core 集成 |
| 数据库 | PostgreSQL 16 | 🆕 新增 | 用户、订阅数据 |
| ORM | Drizzle ORM | 🆕 新增 | 类型安全 ORM |

### 3.2 前端/客户端技术栈

| 类型 | 技术 | 说明 |
|------|------|------|
| Web 框架 | React 18+ | 管理后台 |
| 构建工具 | Vite 5.x | 快速构建 |
| UI 库 | shadcn/ui | TailwindCSS 集成 |
| 桌面框架 | Electron 28+ | Windows 客户端 |
| 状态管理 | Zustand | 轻量状态管理 |
| 数据获取 | TanStack Query 5.x | 服务端状态管理 |
| 图表 | Recharts 2.x | 数据可视化 |

---

## 4. 功能需求

### 4.1 用户认证模块

| 需求编号 | 需求名称 | 描述 | 优先级 |
|----------|----------|------|--------|
| FR-AUTH-001 | 用户注册 | 支持手机号、邮箱、微信等方式注册账号 | P0 |
| FR-AUTH-002 | 用户登录 | 支持密码、验证码、扫码等方式登录 | P0 |
| FR-AUTH-003 | 设备绑定 | 用户可以绑定多台设备到同一账号 | P0 |
| FR-AUTH-004 | 设备配对 | 新设备通过配对码与账号绑定 | P0 |

### 4.2 AI 交互模块

| 需求编号 | 需求名称 | 描述 | 优先级 |
|----------|----------|------|--------|
| FR-AI-001 | 自然语言理解 | 支持中文自然语言输入，理解用户意图 | P0 |
| FR-AI-002 | 任务规划 | AI 将用户请求分解为可执行的任务步骤 | P0 |
| FR-AI-003 | 多轮对话 | 支持上下文关联的多轮对话交互 | P1 |
| FR-AI-004 | 执行确认 | 敏感操作前向用户展示执行计划并确认 | P0 |

### 4.3 技能系统模块

| 需求编号 | 需求名称 | 描述 | 优先级 |
|----------|----------|------|--------|
| FR-SKILL-001 | 服务端技能加载 | 从服务器动态加载技能代码到客户端内存执行 | P0 |
| FR-SKILL-002 | 技能授权验证 | 执行技能前验证用户订阅状态和授权 | P0 |
| FR-SKILL-003 | 本地技能管理 | 用户可以创建、编辑、删除本地技能 | P1 |
| FR-SKILL-004 | 技能商店 | 浏览、搜索、订阅服务端技能 | P1 |
| FR-SKILL-005 | 技能沙箱执行 | 技能在隔离沙箱中执行，限制资源访问 | P0 |

### 4.4 文件管理模块

| 需求编号 | 需求名称 | 描述 | 优先级 |
|----------|----------|------|--------|
| FR-FILE-001 | 文件浏览 | 列出指定目录下的文件和文件夹 | P0 |
| FR-FILE-002 | 文件搜索 | 按名称、类型、大小、日期搜索文件 | P1 |
| FR-FILE-003 | 文件整理 | 按规则自动分类整理文件 | P1 |
| FR-FILE-004 | 批量操作 | 批量重命名、移动、复制、删除文件 | P1 |
| FR-FILE-005 | 垃圾清理 | 清理临时文件、缓存、重复文件 | P2 |

### 4.5 系统监控模块

| 需求编号 | 需求名称 | 描述 | 优先级 |
|----------|----------|------|--------|
| FR-MON-001 | 系统状态 | 显示 CPU、内存、磁盘、网络使用情况 | P1 |
| FR-MON-002 | 进程管理 | 查看运行进程，结束指定进程 | P1 |
| FR-MON-003 | 屏幕截图 | 远程获取屏幕截图 | P2 |
| FR-MON-004 | 告警通知 | 系统异常时发送告警通知 | P2 |

---

## 5. 技能系统设计

### 5.1 技能分类

| 类型 | 存储位置 | 加载方式 | 计费 | 特点 |
|------|----------|----------|------|------|
| 服务端技能 | 云端服务器 | 按需加载到内存 | 订阅/按次 | 不持久化到本地，支持授权控制 |
| 本地技能 | 用户本地 | 本地加载 | 免费 | 用户自建，完全本地化 |

### 5.2 技能生命周期

1. **授权验证** - 检查用户订阅状态
2. **代码下载** - 从服务器获取技能代码
3. **内存加载** - 在沙箱环境中加载执行
4. **执行完成** - 返回结果，清理内存
5. **不持久化** - 技能代码不写入本地

### 5.3 技能商店功能

| 功能 | 描述 |
|------|------|
| 技能浏览 | 分类展示、搜索、筛选 |
| 技能详情 | 功能介绍、使用说明、用户评价 |
| 订阅管理 | 订阅、续费、取消 |
| 开发者入驻 | 技能上架审核、收益分成、数据分析 |

---

## 6. 安全架构

### 6.1 安全层级

| 层级 | 名称 | 保护措施 |
|------|------|----------|
| L1 | 传输安全 | TLS 1.3 加密、证书校验 |
| L2 | 身份认证 | JWT Token、设备指纹、多因素认证 |
| L3 | 授权控制 | RBAC 权限模型、技能级别授权 |
| L4 | 执行沙箱 | 技能隔离执行、资源限制、API 白名单 |
| L5 | 审计日志 | 操作留痕、异常检测、合规审计 |

### 6.2 敏感操作分级

| 级别 | 操作类型 | 处理方式 | 示例 |
|------|----------|----------|------|
| 低 | 读取操作 | 直接执行 | 列出文件、查看系统信息 |
| 中 | 修改操作 | 用户确认 | 重命名文件、安装软件 |
| 高 | 删除操作 | 二次确认 | 删除文件、卸载程序 |
| 危险 | 危险操作 | 禁止执行 | 格式化磁盘、修改注册表 |

### 6.3 技能沙箱安全

```typescript
const sandboxConfig = {
  timeout: 30000,                    // 30 秒超时
  memoryLimit: 256 * 1024 * 1024,    // 256MB 内存

  // API 白名单
  allowedApis: [
    'fs.readFile', 'fs.writeFile', 'fs.readdir',
    'system.getCpuUsage', 'system.getMemoryUsage',
    'ui.confirm', 'ui.notify',
  ],

  // 文件系统限制
  allowedPaths: ['~/Documents', '~/Downloads', '~/Desktop'],

  // 禁止访问
  deniedPaths: ['C:\\Windows', 'C:\\Program Files', '~/.ssh', '~/.gnupg'],
}
```

---

## 7. 非功能需求

### 7.1 性能需求

| 指标 | 要求 | 说明 |
|------|------|------|
| 响应时间 | < 2 秒 | 用户指令到开始执行的时间 |
| 并发用户 | > 1000 | 单个 Gateway 支持的并发连接 |
| 消息延迟 | < 100ms | Gateway 到客户端的消息延迟 |
| 可用性 | > 99.9% | 年度服务可用时间 |
| API 响应 | < 500ms (P95) | 后端 API 响应时间 |

### 7.2 安全需求

| 需求项 | 要求 |
|--------|------|
| 传输加密 | 所有通信必须使用 TLS 1.3 加密 |
| 身份认证 | 支持多因素认证，Token 定期刷新 |
| 权限控制 | 最小权限原则，敏感操作需要额外确认 |
| 审计日志 | 所有操作必须留痕，日志保留 90 天 |
| 数据隐私 | 用户数据加密存储，不收集非必要信息 |

### 7.3 兼容性需求

| 平台 | 支持版本 |
|------|----------|
| Windows | Windows 10 1903+, Windows 11 |
| macOS | macOS 11 (Big Sur) +（计划中） |
| 移动端 | iOS 15+, Android 10+（控制端 App） |
| 浏览器 | Chrome 90+, Edge 90+, Safari 15+（Web 管理后台） |

---

## 8. 商业模式

### 8.1 收入来源

| 收入类型 | 描述 | 定价 |
|----------|------|------|
| 技能订阅 | 按月订阅服务端技能 | ¥9.9-99/月 |
| 按次计费 | 单次使用付费（适合低频技能） | ¥0.1-10/次 |
| 开发者分成 | 第三方技能收入分成 | 平台抽成 30% |
| 企业版 | 私有部署、定制开发 | 按需报价 |

### 8.2 用户套餐

| 套餐 | 免费版 | 专业版 | 企业版 |
|------|--------|--------|--------|
| 价格 | ¥0 | ¥29.9/月 | 按需报价 |
| 设备数量 | 1台 | 5台 | 不限 |
| 本地技能 | ✓ | ✓ | ✓ |
| 服务端技能 | 基础技能 | 全部技能 | 全部 + 定制 |

---

## 9. 通信协议

### 9.1 WebSocket 消息格式

```typescript
interface Message {
  id: string;           // 消息唯一ID
  type: MessageType;    // 消息类型
  payload: any;         // 消息内容
  timestamp: number;    // 时间戳
}

type MessageType =
  | 'auth'           // 认证
  | 'command'        // 执行指令
  | 'result'         // 执行结果
  | 'skill.load'     // 加载技能
  | 'skill.unload'   // 卸载技能
  | 'heartbeat'      // 心跳
  | 'confirm'        // 操作确认
```

### 9.2 RPC 方法

```typescript
// 文件操作
'assistant.fileList': handleFileList,
'assistant.fileRead': handleFileRead,
'assistant.fileWrite': handleFileWrite,
'assistant.fileMove': handleFileMove,
'assistant.fileDelete': handleFileDelete,

// 系统操作
'assistant.systemInfo': handleSystemInfo,
'assistant.processList': handleProcessList,
'assistant.processKill': handleProcessKill,

// 技能操作
'assistant.skillList': handleSkillList,
'assistant.skillLoad': handleSkillLoad,
'assistant.skillExecute': handleSkillExecute,

// 操作确认
'assistant.confirmRequest': handleConfirmRequest,
'assistant.confirmResponse': handleConfirmResponse,
```

---

## 10. 项目结构

```
openclaw/
├── src/                              # 核心代码 (复用)
│   ├── gateway/                      # Gateway 服务
│   ├── agents/                       # AI 代理
│   ├── plugins/                      # 插件系统
│   ├── config/                       # 配置管理
│   ├── routing/                      # 消息路由
│   ├── assistant/                    # 助理模块 (新增)
│   │   ├── skills/                   # 技能系统
│   │   ├── subscription/             # 订阅系统
│   │   ├── payment/                  # 支付系统
│   │   └── audit/                    # 审计日志
│   └── db/                           # 数据库 (新增)
│       └── schema/                   # Drizzle Schema
│
├── apps/
│   ├── windows/                      # Windows 客户端
│   │   ├── src/main/                 # Electron 主进程
│   │   ├── src/renderer/             # 渲染进程 (React)
│   │   └── src/preload/              # 预加载脚本
│   └── admin-console/                # 管理后台
│
└── skills/                           # 技能库
    ├── builtin/                      # 内置技能
    └── templates/                    # 技能模板
```

---

*— 文档结束 —*
